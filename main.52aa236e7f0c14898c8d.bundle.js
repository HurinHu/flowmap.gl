(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var FlowMapLayer_1=__importDefault(__webpack_require__(232));__export(__webpack_require__(232)),__export(__webpack_require__(236));var colors_1=__webpack_require__(395);exports.getColorsRGBA=colors_1.getColorsRGBA,exports.getDiffColorsRGBA=colors_1.getDiffColorsRGBA,exports.isDiffColorsRGBA=colors_1.isDiffColorsRGBA,exports.rgbaAsString=colors_1.rgbaAsString,exports.default=FlowMapLayer_1.default},232:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var LayerKind,core_1=__webpack_require__(17),layers_1=__webpack_require__(233),FlowCirclesLayer_1=__importDefault(__webpack_require__(867)),FlowLinesLayer_1=__importDefault(__webpack_require__(870)),Selectors_1=__importDefault(__webpack_require__(873)),types_1=__webpack_require__(236);!function(LayerKind){LayerKind.LOCATIONS="LOCATIONS",LayerKind.LOCATION_AREAS="LOCATION_AREAS",LayerKind.FLOWS="FLOWS",LayerKind.FLOWS_HIGHLIGHTED="FLOWS_HIGHLIGHTED"}(LayerKind||(LayerKind={}));var LAYER_ID_SEPARATOR=":::";function getLayerId(baseLayerId,layerKind){return""+baseLayerId+LAYER_ID_SEPARATOR+layerKind.valueOf()}function getPickType(_a){switch(function(id){var kind=id.substr(id.lastIndexOf(LAYER_ID_SEPARATOR)+LAYER_ID_SEPARATOR.length);return LayerKind[kind]}(_a.id)){case LayerKind.FLOWS:case LayerKind.FLOWS_HIGHLIGHTED:return types_1.PickingType.FLOW;case LayerKind.LOCATIONS:return types_1.PickingType.LOCATION;case LayerKind.LOCATION_AREAS:return types_1.PickingType.LOCATION_AREA;default:return}}var FlowMapLayer=function(_super){function FlowMapLayer(props){return _super.call(this,props)||this}return __extends(FlowMapLayer,_super),FlowMapLayer.prototype.initializeState=function(){var _a=this.props,getLocationTotalIn=_a.getLocationTotalIn,getLocationTotalOut=_a.getLocationTotalOut,getLocationId=_a.getLocationId,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,selectors=new Selectors_1.default({getLocationId:getLocationId,getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude});this.setState({selectors:selectors})},FlowMapLayer.prototype.updateState=function(params){_super.prototype.updateState.call(this,params);var props=params.props;if(params.changeFlags.propsChanged){var getLocationTotalIn=props.getLocationTotalIn,getLocationTotalOut=props.getLocationTotalOut,getLocationId=props.getLocationId,getFlowOriginId=props.getFlowOriginId,getFlowDestId=props.getFlowDestId,getFlowMagnitude=props.getFlowMagnitude;this.state.selectors.setInputGetters({getLocationId:getLocationId,getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude})}},FlowMapLayer.prototype.getPickingInfo=function(params){var type=getPickType(params.sourceLayer);if(!type)return params.info;var info=__assign({},params.info,{type:type}),selectors=this.state.selectors;if(type===types_1.PickingType.FLOW){var getLocationById=selectors.getLocationByIdGetter(this.props),_a=selectors.getInputGetters(),getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,flow=info.object;return __assign({},info,flow&&{origin:getLocationById(getFlowOriginId(flow)),dest:getLocationById(getFlowDestId(flow))})}if(type===types_1.PickingType.LOCATION||type===types_1.PickingType.LOCATION_AREA){var location_1=type===types_1.PickingType.LOCATION?info.object&&info.object.location:info.object,getLocationTotalIn=selectors.getLocationTotalInGetter(this.props),getLocationTotalOut=selectors.getLocationTotalOutGetter(this.props),getLocationTotalWithin=selectors.getLocationTotalWithinGetter(this.props),getLocationCircleRadius=selectors.getLocationCircleRadiusGetter(this.props);return __assign({},info,location_1&&{object:location_1,totalIn:getLocationTotalIn(location_1),totalOut:getLocationTotalOut(location_1),totalWithin:getLocationTotalWithin(location_1),circleRadius:getLocationCircleRadius({location:location_1,type:"outer"})})}return info},FlowMapLayer.prototype.renderLayers=function(){var _a=this.props,showLocationAreas=_a.showLocationAreas,locations=_a.locations,highlightedLocationId=_a.highlightedLocationId,selectors=this.state.selectors,topFlows=(selectors.getSortedNonSelfFlows(this.props),selectors.getTopFlows(this.props)),highlightedFlows=selectors.getHighlightedFlows(this.props),isLocationHighlighted=null!=highlightedLocationId,layers=[];return showLocationAreas&&types_1.isFeatureCollection(locations)&&layers.push(this.getLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS))),layers.push(this.getFlowLinesLayer(getLayerId(this.props.id,LayerKind.FLOWS),topFlows,!1,isLocationHighlighted)),highlightedFlows&&layers.push(this.getFlowLinesLayer(getLayerId(this.props.id,LayerKind.FLOWS_HIGHLIGHTED),highlightedFlows,!0,!1)),layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id,LayerKind.LOCATIONS))),layers},FlowMapLayer.prototype.getLocationAreasLayer=function(id){var _a=this.props,locations=_a.locations,selectedLocationIds=_a.selectedLocationIds,highlightedLocationId=_a.highlightedLocationId,highlightedFlow=_a.highlightedFlow,selectors=this.state.selectors,colors=selectors.getColors(this.props);return new layers_1.GeoJsonLayer({id:id,getFillColor:selectors.getLocationAreaFillColorGetter(this.props),getLineColor:colors.locationAreas.outline,lineJointRounded:!0,data:locations,stroked:!0,filled:!0,pickable:!0,opacity:1,lineWidthMinPixels:1,pointRadiusMinPixels:1,updateTriggers:{getFillColor:{selectedLocationIds:selectedLocationIds,highlightedLocationId:highlightedLocationId,highlightedFlow:highlightedFlow}}})},FlowMapLayer.prototype.getFlowLinesLayer=function(id,flows,highlighted,dimmed){var _a=this.props,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,getLocationCentroid=_a.getLocationCentroid,showTotals=_a.showTotals,locationCircleSize=_a.locationCircleSize,outlineThickness=_a.outlineThickness,selectors=this.state.selectors,endpointOffsets=[(locationCircleSize||0)+1,(locationCircleSize||0)+1],getLocationRadius=selectors.getLocationCircleRadiusGetter(this.props),getLocationById=selectors.getLocationByIdGetter(this.props),flowThicknessScale=selectors.getFlowThicknessScale(this.props),flowColorScale=selectors.getFlowColorScale(this.props),colors=selectors.getColors(this.props),getColor=selectors.getFlowLinesColorGetter(colors,flowColorScale,highlighted,dimmed);return new FlowLinesLayer_1.default(__assign({id:id,getSourcePosition:function(flow){return getLocationCentroid(getLocationById(getFlowOriginId(flow)))},getTargetPosition:function(flow){return getLocationCentroid(getLocationById(getFlowDestId(flow)))},getThickness:function(flow){return flowThicknessScale(getFlowMagnitude(flow))},getEndpointOffsets:function(flow){return showTotals?[getLocationRadius({location:getLocationById(getFlowOriginId(flow)),type:"outline"}),getLocationRadius({location:getLocationById(getFlowDestId(flow)),type:"outline"})]:endpointOffsets},getColor:getColor,data:flows,opacity:1,pickable:!highlighted,drawOutline:!dimmed,updateTriggers:{getColor:{dimmed:dimmed},getEndpointOffsets:{showTotals:showTotals}},outlineColor:colors.outlineColor},outlineThickness&&{outlineThickness:outlineThickness}))},FlowMapLayer.prototype.getLocationCirclesLayer=function(id){var _this=this,_a=this.props,highlightedLocationId=_a.highlightedLocationId,selectedLocationIds=_a.selectedLocationIds,getLocationCentroid=_a.getLocationCentroid,flows=_a.flows,showTotals=_a.showTotals,selectors=this.state.selectors,getRadius=showTotals?selectors.getLocationCircleRadiusGetter(this.props):function(){return _this.props.locationCircleSize},circles=selectors.getLocationCircles(this.props),getColor=selectors.getLocationCircleColorGetter(this.props);return new FlowCirclesLayer_1.default({id:id,getColor:getColor,getPosition:function(locCircle){return getLocationCentroid(locCircle.location)},getRadius:getRadius,data:circles,opacity:1,pickable:!0,updateTriggers:{getRadius:{selectedLocationIds:selectedLocationIds,flows:flows},getColor:{highlightedLocationId:highlightedLocationId,selectedLocationIds:selectedLocationIds,flows:flows}}})},FlowMapLayer.layerName="FlowMapLayer",FlowMapLayer.defaultProps={getLocationId:{type:"accessor",value:function(l){return l.id||l.properties.id}},getLocationCentroid:{type:"accessor",value:function(l){return l.properties.centroid}},getFlowOriginId:{type:"accessor",value:function(f){return f.origin}},getFlowDestId:{type:"accessor",value:function(f){return f.dest}},getFlowMagnitude:{type:"accessor",value:function(f){return f.magnitude}},showTotals:!0,locationCircleSize:3,outlineThickness:1,showLocationAreas:!0,varyFlowColorByMagnitude:!0},FlowMapLayer}(core_1.CompositeLayer);exports.default=FlowMapLayer},236:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFeatureCollection=function(locations){return"FeatureCollection"===locations.type},function(PickingType){PickingType.LOCATION="location",PickingType.FLOW="flow",PickingType.LOCATION_AREA="location-area"}(exports.PickingType||(exports.PickingType={}))},294:function(module,exports,__webpack_require__){"use strict";(function(module){var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(295)),react_2=__webpack_require__(243),React=__importStar(__webpack_require__(6)),GSheetsExample_1=__importDefault(__webpack_require__(929)),hocs_1=__webpack_require__(407),NonInteractiveExample_1=__importDefault(__webpack_require__(932));exports.mapboxAccessToken="pk.eyJ1IjoiaWx5YWJvLXRlcmFseXRpY3MiLCJhIjoiY2ppaW9wYzJ1MW8weTN2bnJkOHdsbTQ3dSJ9.VP2-bMLHPnmvqxkia-rM3g",react_2.storiesOf("FlowMapLayer",module).add("basic",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("only top 100 flows",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},showTotals:!0,showOnlyTopFlows:100,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("no location areas",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{colors:{outlineColor:"#fff"},getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},showTotals:!0,showLocationAreas:!1,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("no location totals",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},showTotals:!1,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("non-varying flow color",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},showTotals:!0,showLocationAreas:!0,varyFlowColorByMagnitude:!1,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("custom outlines",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{colors:{outlineColor:"#64e9f9"},getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),outlineThickness:5,mapboxAccessToken:exports.mapboxAccessToken})})).add("multiselect",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(react_1.default,{getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},flows:flows,locations:locations,multiselect:!0,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("non-interactive",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(NonInteractiveExample_1.default,{flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken})})).add("difference mode",hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchJson("locations","./data/locations.json"),hocs_1.withFetchJson("flows","./data/flows-diff-2015-2016.json"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(React.Fragment,null,React.createElement(react_1.default,{diffMode:!0,getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(flow){return flow.count},showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:exports.mapboxAccessToken}),React.createElement(react_1.LegendBox,{bottom:35,left:10},React.createElement(react_1.DiffColorsLegend,null),React.createElement("hr",null),React.createElement(react_1.LocationTotalsLegend,{diff:!0})))})),react_2.storiesOf("Other datasets",module).add("London bicycle hire",function(){return React.createElement(GSheetsExample_1.default,{sheetKey:"1Z6dVVFFrdooHIs8xnJ_O7eM5bhS5KscCi7G_k0jUNDI"})}).add("NYC citibike",function(){return React.createElement(GSheetsExample_1.default,{sheetKey:"1Aum0anWxPx6bHyfcFXWCCTE8u0xtfenIls_kPAJEDIA"})}).add("Chicago taxis",function(){return React.createElement(GSheetsExample_1.default,{sheetKey:"1fhX98NFv5gAkkjB2YFCm50-fplFpmWVAZby3dmm9cgQ"})}).add("Relocations in the Netherlands",function(){return React.createElement(GSheetsExample_1.default,{sheetKey:"1rhsLubo_ZCjoBhP7PbX16nm-WUPvtHRguEFXhLJu1Jk"})})}).call(this,__webpack_require__(265)(module))},295:function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var FlowMap_1=__importDefault(__webpack_require__(621)),LocationTotalsLegend_1=__webpack_require__(921);exports.LocationTotalsLegend=LocationTotalsLegend_1.default;var DiffColorsLegend_1=__webpack_require__(922);exports.DiffColorsLegend=DiffColorsLegend_1.default;var LegendBox_1=__webpack_require__(923);exports.LegendBox=LegendBox_1.default,function(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}(__webpack_require__(924)),exports.default=FlowMap_1.default},395:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var d3_color_1=__webpack_require__(393),d3_interpolate_1=__webpack_require__(392),d3_scale_1=__webpack_require__(391),DEFAULT_FLOW_COLOR="#137CBD",DEFAULT_FLOW_COLOR_POSITIVE="#f6654e",DEFAULT_FLOW_COLOR_NEGATIVE="#00a9cc",DEFAULT_OUTLINE_COLOR="#fff",DEFAULT_FLOW_MIN_COLOR="rgba(240,240,240,0.5)",DEFAULT_LOCATION_AREA_COLOR="rgba(220,220,220,0.5)",DEFAULT_DIMMED_OPACITY=.4,FALLBACK_COLOR_RGBA=[255,255,255,255];function getBaseColorsRGBA(colors){return{locationAreas:getLocationAreaColorsRGBA(colors&&colors.locationAreas),outlineColor:colorAsRGBA(colors&&colors.outlineColor||DEFAULT_OUTLINE_COLOR),dimmedOpacity:colors&&null!=colors.dimmedOpacity?colors.dimmedOpacity:DEFAULT_DIMMED_OPACITY}}function getLocationAreaColorsRGBA(colors){var normalColor=colors&&colors.normal||DEFAULT_LOCATION_AREA_COLOR,normalColorHcl=d3_color_1.hcl(normalColor),locationAreasNormal=colorAsRGBA(normalColor);return{normal:locationAreasNormal,connected:colorAsRgbaOr(colors&&colors.connected,locationAreasNormal),highlighted:colorAsRgbaOr(colors&&colors.highlighted,locationAreasNormal),outline:colorAsRgbaOr(colors&&colors.outline,colorAsRGBA(normalColorHcl.darker().toString())),selected:colorAsRgbaOr(colors&&colors.outline,locationAreasNormal)}}function getFlowAndCircleColors(inputColors,defaultFlowColor){var flowColor=inputColors&&inputColors.flows&&inputColors.flows.max||defaultFlowColor,flowColorHcl=d3_color_1.hcl(flowColor),flowColorRGBA=colorAsRGBA(flowColor),flowColorHighlighted=colorAsRgbaOr(inputColors&&inputColors.flows&&inputColors.flows.highlighted,colorAsRGBA(flowColorHcl.darker(.7).toString()));return{flows:{max:flowColorRGBA,min:colorAsRgbaOr(inputColors&&inputColors.flows&&inputColors.flows.min,DEFAULT_FLOW_MIN_COLOR),highlighted:flowColorHighlighted},locationCircles:{inner:flowColorRGBA,outgoing:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.outgoing,flowColorHcl.brighter(3).toString()),incoming:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.incoming,flowColorHcl.darker(1.25).toString()),highlighted:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.highlighted,flowColorHighlighted)}}}function colorAsRGBA(color){var col=d3_color_1.color(color);if(!col)return console.warn("Invalid color: ",color),FALLBACK_COLOR_RGBA;var rgbColor=col.rgb();return[Math.floor(rgbColor.r),Math.floor(rgbColor.g),Math.floor(rgbColor.b),opacityFloatToInteger(col.opacity)]}function colorAsRgbaOr(color,defaultColor){return color?colorAsRGBA(color):"string"==typeof defaultColor?colorAsRGBA(defaultColor):defaultColor}function rgbaAsString(color){return"rgba("+color.join(",")+")"}function opacityFloatToInteger(opacity){return Math.round(255*opacity)}exports.isDiffColors=function(colors){return void 0!==colors.positive},exports.isDiffColorsRGBA=function(colors){return void 0!==colors.positive},exports.getColorsRGBA=function(colors){return __assign({},getBaseColorsRGBA(colors),getFlowAndCircleColors(colors,DEFAULT_FLOW_COLOR))},exports.getDiffColorsRGBA=function(colors){return __assign({},getBaseColorsRGBA(colors),{positive:getFlowAndCircleColors(colors&&colors.positive,DEFAULT_FLOW_COLOR_POSITIVE),negative:getFlowAndCircleColors(colors&&colors.negative,DEFAULT_FLOW_COLOR_NEGATIVE)})},exports.colorAsRGBA=colorAsRGBA,exports.rgbaAsString=rgbaAsString,exports.opacityFloatToInteger=opacityFloatToInteger,exports.getDimmedColor=function(color,opacity){var col=d3_color_1.hcl(rgbaAsString(color));if(!col)return console.warn("Invalid color: ",color),FALLBACK_COLOR_RGBA;col.c*=.1;var rgbColor=col.rgb();return[Math.floor(rgbColor.r),Math.floor(rgbColor.g),Math.floor(rgbColor.b),opacityFloatToInteger(void 0!==opacity?opacity:DEFAULT_DIMMED_OPACITY)]},exports.createFlowColorScale=function(domain,range){var scale=d3_scale_1.scalePow().exponent(1/3).interpolate(d3_interpolate_1.interpolateHcl).range(range.map(rgbaAsString)).domain(domain);return function(value){return colorAsRGBA(scale(value))}}},406:function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=__webpack_require__(119),React=__importStar(__webpack_require__(6));exports.default=function(_a){var size=_a.size,inner=_a.inner,outer=_a.outer;return React.createElement("svg",{width:size,height:size,style:{marginRight:5}},React.createElement("circle",{cx:size/2,cy:size/2,r:.5*size,fill:core_1.rgbaAsString(outer)}),React.createElement("circle",{cx:size/2,cy:size/2,r:.5*size*.75,fill:core_1.rgbaAsString(inner)}))}},407:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var d3_dsv_1=__webpack_require__(930),React=__importStar(__webpack_require__(6)),stats_js_1=__importDefault(__webpack_require__(931));exports.pipe=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(d){return args.reduce(function(m,f){return f(m)},d)}};var Message=function(_a){var children=_a.children;return React.createElement("div",{style:{padding:"1em"}},children)},withFetch=function(mode,propName,url){return function(Comp){return function(props){var Fetcher=function(_super){function Fetcher(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.state={error:null,data:null},_this}return __extends(Fetcher,_super),Fetcher.prototype.componentDidMount=function(){var _this=this;fetch(url).then(function(response){if(!response.ok)throw new Error(response.statusText);switch(mode){case"json":return response.json();case"csv":return response.text()}}).catch(function(reason){console.log(reason),_this.setState({error:!0})}).then(function(data){return _this.setState({data:"csv"===mode?d3_dsv_1.csvParse(data):data})})},Fetcher.prototype.render=function(){var _a,_b=this.state,data=_b.data;return _b.error?React.createElement(Message,null,"Oops… Data fetching failed."):data?React.createElement(Comp,__assign({},__assign({},props,((_a={})[propName]=this.state.data,_a)))):React.createElement(Message,null,"Fetching data…")},Fetcher}(React.Component);return React.createElement(Fetcher,null)}}};exports.withFetchCsv=function(propName,url){return withFetch("csv",propName,url)},exports.withFetchJson=function(propName,url){return withFetch("json",propName,url)},exports.withStats=function(Comp){return function(props){var WithStats=function(_super){function WithStats(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.stats=new stats_js_1.default,_this.statsContainer=React.createRef(),_this.animateRef=0,_this}return __extends(WithStats,_super),WithStats.prototype.componentDidMount=function(){var _this=this;this.statsContainer.current&&(this.stats.showPanel(0),this.statsContainer.current.appendChild(this.stats.dom));var calcFPS=function(){_this.stats.begin(),_this.stats.end(),_this.animateRef=window.requestAnimationFrame(calcFPS)};this.animateRef=window.requestAnimationFrame(calcFPS)},WithStats.prototype.componentWillUnmount=function(){window.cancelAnimationFrame(this.animateRef)},WithStats.prototype.render=function(){return React.createElement(React.Fragment,null,React.createElement(Comp,__assign({},props)),React.createElement("div",{ref:this.statsContainer}))},WithStats}(React.Component);return React.createElement(WithStats,null)}}},414:function(module,exports,__webpack_require__){__webpack_require__(415),__webpack_require__(494),module.exports=__webpack_require__(495)},495:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(243),_storybook_addon_options__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(413);__webpack_require__(497),Object(_storybook_addon_options__WEBPACK_IMPORTED_MODULE_1__.withOptions)({name:"flowmap.gl",url:"https://github.com/teralytics/flowmap.gl"}),Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)(function(){__webpack_require__(294)},module)}.call(this,__webpack_require__(496)(module))},621:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__rest=this&&this.__rest||function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&(t[p[i]]=s[p[i]])}return t},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(296),core_1=__importStar(__webpack_require__(119)),React=__importStar(__webpack_require__(6)),react_map_gl_1=__webpack_require__(879),ESC_KEY="Escape",FlowMap=function(_super){function FlowMap(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.state={viewState:_this.props.initialViewState},_this.handleFlowMapHover=function(info){var type=info.type,object=info.object;switch(type){case core_1.PickingType.FLOW:object?_this.highlight({type:"flow",flow:object},info):_this.highlight(void 0);break;case core_1.PickingType.LOCATION:var getLocationId=_this.props.getLocationId;object?_this.highlight({type:"location",locationId:(getLocationId||core_1.default.defaultProps.getLocationId.value)(object)},info):_this.highlight(void 0);break;case core_1.PickingType.LOCATION_AREA:_this.highlight(void 0)}},_this.handleFlowMapClick=function(_a){var type=_a.type,object=_a.object;switch(type){case core_1.PickingType.LOCATION:if(object){var _b=_this.props,getLocationId=_b.getLocationId,multiselect=_b.multiselect,selectedLocationIds=_this.state.selectedLocationIds,locationId_1=(getLocationId||core_1.default.defaultProps.getLocationId.value)(object),isSelected=selectedLocationIds&&selectedLocationIds.indexOf(locationId_1)>=0,next=void 0;next=multiselect?selectedLocationIds?isSelected?selectedLocationIds.filter(function(id){return id!==locationId_1}):selectedLocationIds.concat([locationId_1]):[locationId_1]:isSelected?void 0:[locationId_1],_this.selectLocations(next)}break;case core_1.PickingType.LOCATION_AREA:}},_this.handleViewStateChange=function(_a){var viewState=_a.viewState;return _this.setState({viewState:viewState,highlight:void 0})},_this.handleKeyDown=function(evt){evt instanceof KeyboardEvent&&evt.key===ESC_KEY&&_this.setState({selectedLocationIds:void 0,highlight:void 0})},_this}return __extends(FlowMap,_super),FlowMap.getDerivedStateFromProps=function(props,state){return props.selectedLocationIds&&props.selectedLocationIds!==state.selectedLocationIds?{selectedLocationIds:props.selectedLocationIds}:null},FlowMap.prototype.componentDidMount=function(){document.addEventListener("keydown",this.handleKeyDown)},FlowMap.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.handleKeyDown)},FlowMap.prototype.render=function(){var _a=this.props,mapboxAccessToken=_a.mapboxAccessToken,mixBlendMode=_a.mixBlendMode,flowMapLayer=this.getFlowMapLayer(),viewState=this.state.viewState;return React.createElement(React.Fragment,null,React.createElement(react_1.DeckGL,{style:{mixBlendMode:mixBlendMode},layers:[flowMapLayer],viewState:viewState,controller:!0,onViewStateChange:this.handleViewStateChange,children:function(_a){var width=_a.width,height=_a.height,viewState=_a.viewState;return React.createElement(react_map_gl_1.StaticMap,{mapboxApiAccessToken:mapboxAccessToken,width:width,height:height,viewState:viewState})}}))},FlowMap.prototype.getFlowMapLayer=function(){var _a=this.props,flowMapLayerProps=(_a.initialViewState,_a.mapboxAccessToken,_a.mixBlendMode,_a.multiselect,_a.onSelected,_a.onHighlighted,__rest(_a,["initialViewState","mapboxAccessToken","mixBlendMode","multiselect","onSelected","onHighlighted"])),_b=this.state,highlight=_b.highlight,selectedLocationIds=_b.selectedLocationIds;return new core_1.default(__assign({id:"flow-map-layer"},flowMapLayerProps,{selectedLocationIds:selectedLocationIds,highlightedLocationId:highlight&&"location"===highlight.type?highlight.locationId:void 0,highlightedFlow:highlight&&"flow"===highlight.type?highlight.flow:void 0,onHover:this.handleFlowMapHover,onClick:this.handleFlowMapClick}))},FlowMap.prototype.highlight=function(highlight,info){this.setState({highlight:highlight});var onHighlighted=this.props.onHighlighted;onHighlighted&&onHighlighted(highlight,info)},FlowMap.prototype.selectLocations=function(selectedLocationIds){this.setState(function(state){return __assign({},state,{selectedLocationIds:selectedLocationIds})});var onSelected=this.props.onSelected;onSelected&&onSelected(selectedLocationIds)},FlowMap.defaultProps={mixBlendMode:"multiply"},FlowMap}(React.Component);exports.default=FlowMap},638:function(module,exports){},641:function(module,exports){},642:function(module,exports){},867:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var layers_1=__webpack_require__(233),FlowCirclesLayerFragment_glsl_1=__importDefault(__webpack_require__(868)),FlowCirclesLayerVertex_glsl_1=__importDefault(__webpack_require__(869)),FlowCirclesLayer=function(_super){function FlowCirclesLayer(props){return _super.call(this,props)||this}return __extends(FlowCirclesLayer,_super),FlowCirclesLayer.prototype.getShaders=function(){var shaders=_super.prototype.getShaders.call(this);return __assign({},shaders,{vs:FlowCirclesLayerVertex_glsl_1.default,fs:FlowCirclesLayerFragment_glsl_1.default})},FlowCirclesLayer.layerName="FlowCirclesLayer",FlowCirclesLayer}(layers_1.ScatterplotLayer);exports.default=FlowCirclesLayer},868:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="#define SHADER_NAME flow-circles-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0 || distToCenter < innerUnitRadius) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  \n  const float SOFT_OUTLINE = 0.1;\n  float soften = smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);\n  gl_FragColor = vec4(vColor.rgb, vColor.a * soften);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n"},869:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="#define SHADER_NAME flow-circles-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float outline;\nuniform float strokeWidth;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  // Multiply out radius and clamp to limits\n  float outerRadiusPixels = instanceRadius;\n  \n  // outline is centered at the radius\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += outline * strokeWidth / 2.0;\n  \n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  // 0 - solid circle, 1 - stroke with lineWidth=0\n  innerUnitRadius = outline * (1.0 - strokeWidth / outerRadiusPixels);\n  \n  // Find the center of the point and add the current vertex\n  vec3 center = project_position(instancePositions);\n  vec3 vertex = positions * outerRadiusPixels;\n  gl_Position = project_to_clipspace(vec4(center + vertex, 1.0));\n  \n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  \n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n"},870:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=__webpack_require__(17),luma_gl_1=__webpack_require__(11),constants_1=__webpack_require__(22),FlowLinesLayerFragment_glsl_1=__importDefault(__webpack_require__(871)),FlowLinesLayerVertex_glsl_1=__importDefault(__webpack_require__(872)),DEFAULT_COLOR=[0,132,193,255],FlowLinesLayer=function(_super){function FlowLinesLayer(props){return _super.call(this,props)||this}return __extends(FlowLinesLayer,_super),FlowLinesLayer.prototype.getShaders=function(){var projectModule=this.use64bitProjection()?"project64":"project32";return{vs:FlowLinesLayerVertex_glsl_1.default,fs:FlowLinesLayerFragment_glsl_1.default,modules:[projectModule,"picking"],shaderCache:this.context.shaderCache}},FlowLinesLayer.prototype.initializeState=function(){var gl=this.context.gl;this.setState({model:this.createModel(gl)}),this.state.attributeManager.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:constants_1.UNSIGNED_BYTE,transition:!1}})},FlowLinesLayer.prototype.draw=function(opts){var gl=this.context.gl,outlineColor=this.props.outlineColor;gl.lineWidth(1),this.state.model.draw(__assign({},opts,{uniforms:__assign({},opts.uniforms,{outlineColor:outlineColor.map(function(x){return x/255}),thicknessUnit:16,gap:.75})}))},FlowLinesLayer.prototype.createModel=function(gl){var positions=[],pixelOffsets=[],_a=this.props,drawOutline=_a.drawOutline,outlineThickness=_a.outlineThickness;if(drawOutline){positions=positions.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]);var tout=outlineThickness;pixelOffsets=pixelOffsets.concat([-1,-tout,1,tout,-tout,1,-1,tout,1,tout,-tout,1,-1,0,1,tout,0,1,-1,3*tout,1,2*tout,-tout,1,-1,-tout,1])}return positions=positions.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]),pixelOffsets=pixelOffsets.concat([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),new luma_gl_1.Model(gl,__assign({id:this.props.id},this.getShaders(),{geometry:new luma_gl_1.Geometry({drawType:constants_1.TRIANGLES,attributes:{positions:new Float32Array(positions),normals:new Float32Array(pixelOffsets)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))},FlowLinesLayer.layerName="FlowLinesLayer",FlowLinesLayer.defaultProps={getSourcePosition:{type:"accessor",value:function(d){return d.sourcePosition}},getTargetPosition:{type:"accessor",value:function(d){return d.targetPosition}},getColor:{type:"accessor",value:DEFAULT_COLOR},getThickness:{type:"accessor",value:function(d){return d.thickness}},drawOutline:!0,outlineThickness:1,outlineColor:[255,255,255,255]},FlowLinesLayer}(core_1.Layer);exports.default=FlowLinesLayer},871:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="#define SHADER_NAME flow-line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  if (vColor.a == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  \n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  \n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n"},872:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="#define SHADER_NAME flow-line-layer-vertex-shader\n#define PI 3.1415926535897932384626433832795\n\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 instanceColors;\nattribute float instanceThickness;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceEndpointOffsets;\n\nuniform vec4 outlineColor;\nuniform float thicknessUnit;\nuniform float gap;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nmat2 rotation_mat2(float a) {\n  return mat2(cos(a), sin(a), -sin(a), cos(a));\n}\n\nvec2 vec3_to_vec2(vec3 a) {\n  return vec2(a[0], a[1]);\n}\n\nvoid main(void) {\n  vec2 projectedSourceCoord = vec3_to_vec2(project_position(instanceSourcePositions));\n  vec2 projectedTargetCoord = vec3_to_vec2(project_position(instanceTargetPositions));\n\n\n  vec2 sourceTarget = projectedTargetCoord - projectedSourceCoord;\n  float offsetLimit = length(sourceTarget) * 0.8;\n  vec2 flowlineDirection = normalize(sourceTarget);\n  vec2 limitedOffsetDistances = clamp(positions.yz * thicknessUnit, -offsetLimit, offsetLimit);\n  float endpointOffset = mix(instanceEndpointOffsets.x, -instanceEndpointOffsets.y, positions.x);\n  vec2 offset =\n    rotation_mat2(0.5*PI) * flowlineDirection * (instanceThickness * limitedOffsetDistances[0] + gap + normals.x) +\n    flowlineDirection * (instanceThickness * limitedOffsetDistances[1] + normals.y + endpointOffset)\n  ;\n\n\n  vec2 mixed_temp = mix(projectedSourceCoord, projectedTargetCoord, positions.x);\n\n  vec4 vertex_pos_modelspace;\n\n  vertex_pos_modelspace[0] = mixed_temp[0] + offset[0];\n  vertex_pos_modelspace[1] = mixed_temp[1] + offset[1];\n  vertex_pos_modelspace[2] = 0.0;\n  vertex_pos_modelspace[3] = 1.0;\n\n\n  gl_Position = project_to_clipspace(vertex_pos_modelspace);\n  \n  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);\n  \n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n"},873:function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var d3_array_1=__webpack_require__(874),d3_collection_1=__webpack_require__(390),d3_scale_1=__webpack_require__(391),reselect_1=__webpack_require__(878),colors_1=__webpack_require__(395),FlowMapLayer_1=__importDefault(__webpack_require__(232)),types_1=__webpack_require__(236),getDiffMode=function(props){return props.diffMode},getColorsProp=function(props){return props.colors},getLocationFeatures=function(props){return types_1.isFeatureCollection(props.locations)?props.locations.features:props.locations},getFlows=function(props){return props.flows},getHighlightedFlow=function(props){return props.highlightedFlow},getHighlightedLocationId=function(props){return props.highlightedLocationId},getSelectedLocationIds=function(props){return props.selectedLocationIds},getVaryFlowColorByMagnitude=function(props){return props.varyFlowColorByMagnitude},getShowOnlyTopFlows=function(props){return props.showOnlyTopFlows},getOutlineThickness=function(props){return null!=props.outlineThickness?props.outlineThickness:FlowMapLayer_1.default.defaultProps.outlineThickness},MIN_OUTLINE_CIRCLE_RADIUS=3,Selectors=function(){function Selectors(inputGetters){var _this=this;this.inputGetters=inputGetters,this.getColors=reselect_1.createSelector([getColorsProp,getDiffMode],function(colors,diffMode){return diffMode?colors_1.getDiffColorsRGBA(colors):colors_1.getColorsRGBA(colors)}),this.getLocationByIdGetter=reselect_1.createSelector([getLocationFeatures],function(locations){var locationsById=d3_collection_1.nest().key(_this.inputGetters.getLocationId).rollup(function(_a){return _a[0]}).object(locations);return function(id){var location=locationsById[id];return location||console.warn("No location found for id '"+id+"'"),location}}),this.getFilteredFlows=reselect_1.createSelector([getFlows,getSelectedLocationIds],function(flows,selectedLocationIds){var _a=_this.inputGetters,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;return selectedLocationIds?flows.filter(function(flow){return selectedLocationIds.indexOf(getFlowOriginId(flow))>=0||selectedLocationIds.indexOf(getFlowDestId(flow))>=0}):flows}),this.getNonSelfFlows=reselect_1.createSelector([this.getFilteredFlows],function(flows){var _a=_this.inputGetters,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;return flows.filter(function(flow){return getFlowOriginId(flow)!==getFlowDestId(flow)})}),this.getSortedNonSelfFlows=reselect_1.createSelector([this.getNonSelfFlows],function(flows){return flows.slice().sort(function(f1,f2){return Math.abs(_this.inputGetters.getFlowMagnitude(f1))-Math.abs(_this.inputGetters.getFlowMagnitude(f2))})}),this.getTopFlows=reselect_1.createSelector([this.getSortedNonSelfFlows,getShowOnlyTopFlows],function(flows,showOnlyTopFlows){return null!=showOnlyTopFlows&&showOnlyTopFlows>0&&flows.length>showOnlyTopFlows?flows.slice(flows.length-showOnlyTopFlows,flows.length):flows}),this.getHighlightedFlows=reselect_1.createSelector([this.getSortedNonSelfFlows,getHighlightedFlow,getHighlightedLocationId],function(flows,highlightedFlow,highlightedLocationId){var _a=_this.inputGetters,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;return highlightedFlow?[highlightedFlow]:highlightedLocationId?flows.filter(function(flow){return getFlowOriginId(flow)===highlightedLocationId||getFlowDestId(flow)===highlightedLocationId}):void 0}),this.getFlowMagnitudeExtent=reselect_1.createSelector([this.getNonSelfFlows],function(flows){return d3_array_1.extent(flows,_this.inputGetters.getFlowMagnitude)}),this.getFlowThicknessScale=reselect_1.createSelector([this.getFlowMagnitudeExtent],function(_a){var minMagnitude=_a[0],maxMagnitude=_a[1],scale=d3_scale_1.scaleLinear().range([.05,.5]).domain([0,Math.max(Math.abs(minMagnitude||0),Math.abs(maxMagnitude||0))]);return function(magnitude){return scale(Math.abs(magnitude))}}),this.getFlowColorScale=reselect_1.createSelector([this.getColors,this.getFlowMagnitudeExtent,getVaryFlowColorByMagnitude],function(colors,_a,varyFlowColorByMagnitude){var minMagnitude=_a[0],maxMagnitude=_a[1];if(!varyFlowColorByMagnitude)return colors_1.isDiffColorsRGBA(colors)?function(v){return v>=0?colors.positive.flows.max:colors.negative.flows.max}:function(){return colors.flows.max};if(colors_1.isDiffColorsRGBA(colors)){var posScale_1=colors_1.createFlowColorScale([0,maxMagnitude||0],[colors.positive.flows.min,colors.positive.flows.max]),negScale_1=colors_1.createFlowColorScale([minMagnitude||0,0],[colors.negative.flows.max,colors.negative.flows.min]);return function(magnitude){return magnitude>=0?posScale_1(magnitude):negScale_1(magnitude)}}var _b=colors.flows,max=_b.max,min=_b.min,scale=colors_1.createFlowColorScale([0,maxMagnitude||0],[min,max]);return function(magnitude){return scale(magnitude)}}),this.getLocationTotals=reselect_1.createSelector([getLocationFeatures,this.getFilteredFlows],function(locations,flows){var _a=_this.inputGetters,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude;return flows.reduce(function(acc,curr){var originId=getFlowOriginId(curr),destId=getFlowDestId(curr),magnitude=getFlowMagnitude(curr);return originId===destId?acc.within[originId]=(acc.within[originId]||0)+magnitude:(acc.outgoing[originId]=(acc.outgoing[originId]||0)+magnitude,acc.incoming[destId]=(acc.incoming[destId]||0)+magnitude),acc},{incoming:{},outgoing:{},within:{}})}),this.getLocationCircles=reselect_1.createSelector([getLocationFeatures],function(locations){for(var circles=[],_i=0,locations_1=locations;_i<locations_1.length;_i++){var location_1=locations_1[_i];circles.push({location:location_1,type:"outline"}),circles.push({location:location_1,type:"outer"}),circles.push({location:location_1,type:"inner"})}return circles}),this.getLocationTotalInGetter=function(props){var _a=_this.inputGetters,getLocationTotalIn=_a.getLocationTotalIn,getLocationId=_a.getLocationId;if(getLocationTotalIn)return getLocationTotalIn;var incoming=_this.getLocationTotals(props).incoming;return function(location){return incoming[getLocationId(location)]||0}},this.getLocationTotalOutGetter=function(props){var _a=_this.inputGetters,getLocationTotalOut=_a.getLocationTotalOut,getLocationId=_a.getLocationId;if(getLocationTotalOut)return getLocationTotalOut;var outgoing=_this.getLocationTotals(props).outgoing;return function(location){return outgoing[getLocationId(location)]||0}},this.getLocationTotalWithinGetter=function(props){var _a=_this.inputGetters,getLocationTotalWithin=_a.getLocationTotalWithin,getLocationId=_a.getLocationId;if(getLocationTotalWithin)return getLocationTotalWithin;var within=_this.getLocationTotals(props).within;return function(location){return within[getLocationId(location)]||0}},this.getLocationMaxAbsTotal=reselect_1.createSelector([getLocationFeatures,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],function(locations,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin){return d3_array_1.max(locations,function(location){return Math.max(Math.abs(getLocationTotalIn(location)+getLocationTotalWithin(location)),Math.abs(getLocationTotalOut(location)+getLocationTotalWithin(location)))})||0}),this.getSizeScale=reselect_1.createSelector([this.getLocationMaxAbsTotal],function(maxTotal){var scale=d3_scale_1.scalePow().exponent(.5).domain([0,maxTotal]).range([0,15]);return function(v){return scale(Math.abs(v))}}),this.getLocationCircleRadiusGetter=reselect_1.createSelector([getOutlineThickness,this.getSizeScale,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],function(outlineThickness,sizeScale,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin){return function(_a){var location=_a.location,type=_a.type,getSide="inner"===type?Math.min:Math.max,totalIn=getLocationTotalIn(location),totalOut=getLocationTotalOut(location),totalWithin=getLocationTotalWithin(location),r=sizeScale(getSide(totalIn+totalWithin,totalOut+totalWithin));return"outline"===type?Math.max(r+outlineThickness,MIN_OUTLINE_CIRCLE_RADIUS):r}}),this.getLocationCircleColorGetter=reselect_1.createSelector([this.getColors,getHighlightedLocationId,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],function(colors,highlightedLocationId,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin){var getLocationId=_this.inputGetters.getLocationId;return function(_a){var location=_a.location,type=_a.type,isHighlighted=highlightedLocationId&&highlightedLocationId===getLocationId(location),isDimmed=highlightedLocationId&&highlightedLocationId!==getLocationId(location),totalWithin=getLocationTotalWithin(location),totalIn=getLocationTotalIn(location)+totalWithin,totalOut=getLocationTotalOut(location)+totalWithin,isIncoming="outer"===type&&Math.abs(totalIn)>Math.abs(totalOut),isPositive=!0===isIncoming&&totalIn>=0||totalOut>=0,circleColors=(colors_1.isDiffColorsRGBA(colors)?isPositive?colors.positive:colors.negative:colors).locationCircles;return isHighlighted&&"outline"===type?circleColors.highlighted:isDimmed&&"outline"!==type?colors_1.getDimmedColor(circleColors.inner,colors.dimmedOpacity):"outline"===type?colors.outlineColor:"inner"===type?circleColors.inner:!0===isIncoming?circleColors.incoming:circleColors.outgoing}}),this.isLocationConnectedGetter=reselect_1.createSelector([this.getFilteredFlows,getHighlightedLocationId,getHighlightedFlow,getSelectedLocationIds],function(flows,highlightedLocationId,highlightedFlow,selectedLocationIds){var _a=_this.inputGetters,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;if(highlightedLocationId){for(var isRelated=function(flow){var originId=getFlowOriginId(flow),destId=getFlowDestId(flow);return originId===highlightedLocationId||selectedLocationIds&&selectedLocationIds.indexOf(originId)>=0||destId===highlightedLocationId||selectedLocationIds&&selectedLocationIds.indexOf(destId)>=0},locations_2=new Set,_i=0,flows_1=flows;_i<flows_1.length;_i++){var flow=flows_1[_i];isRelated(flow)&&(locations_2.add(getFlowOriginId(flow)),locations_2.add(getFlowDestId(flow)))}return function(id){return locations_2.has(id)}}return function(){return!1}}),this.getLocationAreaFillColorGetter=reselect_1.createSelector([this.getColors,getSelectedLocationIds,getHighlightedLocationId,this.isLocationConnectedGetter],function(colors,selectedLocationIds,highlightedLocationId,isLocationConnected){return function(location){var locationId=_this.inputGetters.getLocationId(location);return selectedLocationIds&&selectedLocationIds.indexOf(locationId)>=0?colors.locationAreas.selected:locationId===highlightedLocationId?colors.locationAreas.highlighted:!0===isLocationConnected(locationId)?colors.locationAreas.connected:colors.locationAreas.normal}})}return Selectors.prototype.getFlowLinesColorGetter=function(colors,flowColorScale,highlighted,dimmed){var getFlowMagnitude=this.inputGetters.getFlowMagnitude;if(highlighted){if(colors_1.isDiffColorsRGBA(colors)){var positiveColor_1=colors.positive.flows.highlighted,negativeColor_1=colors.negative.flows.highlighted;return function(flow){return getFlowMagnitude(flow)>=0?positiveColor_1:negativeColor_1}}return colors.flows.highlighted}return function(flow){var magnitude=getFlowMagnitude(flow),color=flowColorScale(magnitude);return dimmed?colors_1.getDimmedColor(color,colors.dimmedOpacity):color}},Selectors.prototype.setInputGetters=function(inputGetters){this.inputGetters=inputGetters},Selectors.prototype.getInputGetters=function(){return this.inputGetters},Selectors}();exports.default=Selectors},921:function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=__webpack_require__(119),React=__importStar(__webpack_require__(6)),Disc_1=__importDefault(__webpack_require__(406)),styles={outer:{display:"flex",flexDirection:"column"},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}};exports.default=function(_a){var diff=_a.diff,colors=_a.colors,colorsRGBA=diff?core_1.getDiffColorsRGBA(colors):core_1.getColorsRGBA(colors),pos=core_1.isDiffColorsRGBA(colorsRGBA)?colorsRGBA.positive.locationCircles:colorsRGBA.locationCircles,neg=core_1.isDiffColorsRGBA(colorsRGBA)?colorsRGBA.negative.locationCircles:void 0;return React.createElement("div",{style:styles.outer},React.createElement("div",null,React.createElement("div",{style:styles.item.outer},React.createElement(Disc_1.default,{size:20,inner:pos.inner,outer:pos.inner}),neg&&React.createElement(Disc_1.default,{size:20,inner:neg.inner,outer:neg.inner}),React.createElement("div",{style:styles.item.caption},"outgoing ≅ incoming")),React.createElement("div",{style:styles.item.outer},React.createElement(Disc_1.default,{size:20,inner:pos.inner,outer:pos.outgoing}),neg&&React.createElement(Disc_1.default,{size:20,inner:neg.inner,outer:neg.outgoing}),React.createElement("div",{style:styles.item.caption},"more outgoing")),React.createElement("div",{style:styles.item.outer},React.createElement(Disc_1.default,{size:20,inner:pos.inner,outer:pos.incoming}),neg&&React.createElement(Disc_1.default,{size:20,inner:neg.inner,outer:neg.incoming}),React.createElement("div",{style:styles.item.caption},"more incoming"))))}},922:function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=__webpack_require__(119),React=__importStar(__webpack_require__(6)),Disc_1=__importDefault(__webpack_require__(406)),styles={outer:{display:"flex",flexDirection:"column"},disc:{marginRight:5},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}};exports.default=function(_a){var colors=_a.colors,colorsRGBA=core_1.getDiffColorsRGBA(colors),pos=colorsRGBA.positive.locationCircles,neg=colorsRGBA.negative.locationCircles;return React.createElement("div",{style:styles.outer},React.createElement("div",{style:styles.item.outer},React.createElement(Disc_1.default,{size:20,inner:pos.inner,outer:pos.inner}),React.createElement("div",{style:styles.item.caption},"positive difference")),React.createElement("div",{style:styles.item.outer},React.createElement(Disc_1.default,{size:20,inner:neg.inner,outer:neg.inner}),React.createElement("div",{style:styles.item.caption},"negative difference")))}},923:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var React=__importStar(__webpack_require__(6)),styles_outer={position:"absolute",background:"#fff",padding:10,borderRadius:4,border:"1px solid #ccc"};exports.default=function(_a){var top=_a.top,left=_a.left,right=_a.right,bottom=_a.bottom,children=_a.children;return React.createElement("div",{style:__assign({},styles_outer,{top:top,left:left,right:right,bottom:bottom})},children)}},924:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var geo_viewport_1=__webpack_require__(925),d3_geo_1=__webpack_require__(927);function getViewStateForFeatures(featureCollection,size,opts){var _a=opts||{},_b=_a.pad,pad=void 0===_b?.05:_b,_c=_a.tileSize,tileSize=void 0===_c?512:_c,_d=_a.minZoom,minZoom=void 0===_d?0:_d,_e=_a.maxZoom,maxZoom=void 0===_e?100:_e,_f=d3_geo_1.geoBounds(featureCollection),_g=_f[0],x1=_g[0],y1=_g[1],_h=_f[1],x2=_h[0],y2=_h[1],bounds=[x1-pad*(x2-x1),y1-pad*(y2-y1),x2+pad*(x2-x1),y2+pad*(y2-y1)],_j=geo_viewport_1.viewport(bounds,size,void 0,void 0,tileSize,!0),_k=_j.center,longitude=_k[0],latitude=_k[1],zoom=_j.zoom;return{longitude:longitude,latitude:latitude,zoom:Math.max(Math.min(maxZoom,zoom),minZoom),bearing:0,pitch:0}}exports.getViewStateForFeatures=getViewStateForFeatures,exports.getViewStateForLocations=function(locations,getLocationCentroid,size,opts){return getViewStateForFeatures({type:"GeometryCollection",geometries:locations.map(function(location){return{type:"Point",coordinates:getLocationCentroid(location)}})},size,opts)}},929:function(module,exports,__webpack_require__){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(295)),React=__importStar(__webpack_require__(6)),_1=__webpack_require__(294),hocs_1=__webpack_require__(407),getFlowMagnitude=function(flow){return+flow.count},getFlowOriginId=function(flow){return flow.origin},getFlowDestId=function(flow){return flow.dest},getLocationId=function(loc){return loc.id},getLocationCentroid=function(location){return[+location.lon,+location.lat]};exports.default=function(_a){var sheetKey=_a.sheetKey,Comp=hocs_1.pipe(hocs_1.withStats,hocs_1.withFetchCsv("locations","https://docs.google.com/spreadsheets/d/"+sheetKey+"/gviz/tq?tqx=out:csv&sheet=locations"),hocs_1.withFetchCsv("flows","https://docs.google.com/spreadsheets/d/"+sheetKey+"/gviz/tq?tqx=out:csv&sheet=flows"))(function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(React.Fragment,null,React.createElement(react_1.default,{initialViewState:react_1.getViewStateForLocations(locations,getLocationCentroid,[window.innerWidth,window.innerHeight]),showTotals:!0,showLocationAreas:!1,showOnlyTopFlows:1e4,flows:flows,locations:locations,mapboxAccessToken:_1.mapboxAccessToken,getLocationId:getLocationId,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getLocationCentroid:getLocationCentroid,getFlowMagnitude:getFlowMagnitude}),React.createElement(react_1.LegendBox,{bottom:35,left:10},React.createElement(react_1.LocationTotalsLegend,null)),React.createElement(react_1.LegendBox,{bottom:35,right:10},"Showing "+(flows.length>1e4?"top 10000 of":"")+" "+flows.length+" flows. ",React.createElement("a",{href:"https://docs.google.com/spreadsheets/d/"+sheetKey+"/edit?usp=sharing",target:"_blank",rel:"noopener"},"Data source")))});return React.createElement(Comp,null)}},932:function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(296),core_1=__importDefault(__webpack_require__(119)),React=__importStar(__webpack_require__(6)),react_map_gl_1=__webpack_require__(933);exports.default=function(_a){var locations=_a.locations,flows=_a.flows,initialViewState=_a.initialViewState,mapboxAccessToken=_a.mapboxAccessToken,outlineThickness=_a.outlineThickness,flowMapLayer=new core_1.default({id:"flow-map-layer",locations:locations,flows:flows,getLocationId:function(loc){return loc.properties.abbr},showLocationAreas:!0,getFlowMagnitude:function(f){return f.count},varyFlowColorByMagnitude:!0,showTotals:!0,outlineThickness:outlineThickness});return React.createElement(react_1.DeckGL,{style:{mixBlendMode:"multiply"},controller:!0,initialViewState:initialViewState,layers:[flowMapLayer],children:function(_a){var width=_a.width,height=_a.height,viewState=_a.viewState;return React.createElement(react_map_gl_1.StaticMap,{mapboxApiAccessToken:mapboxAccessToken,width:width,height:height,viewState:viewState})}})}}},[[414,1,2]]]);
//# sourceMappingURL=main.52aa236e7f0c14898c8d.bundle.js.map