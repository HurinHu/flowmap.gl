(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{238:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(d){return args.reduce((function(m,f){return f(m)}),d)}}},306:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var d3_dsv_1=__webpack_require__(772),react_1=__importDefault(__webpack_require__(8));exports.Message=function(_a){var children=_a.children;return react_1.default.createElement("div",{style:{padding:"1em"}},children)};var withFetch=function(mode,propName,url){return function(Comp){return function(props){var Fetcher=function(_super){function Fetcher(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.state={error:null,data:null},_this}return __extends(Fetcher,_super),Fetcher.prototype.componentDidMount=function(){var _this=this;fetch(url).then((function(response){if(!response.ok)throw new Error(response.statusText);switch(mode){case"json":return response.json();case"csv":return response.text()}})).catch((function(reason){console.log(reason),_this.setState({error:!0})})).then((function(data){return _this.setState({data:"csv"===mode?d3_dsv_1.csvParse(data):data})}))},Fetcher.prototype.render=function(){var _a,_b=this.state,data=_b.data;return _b.error?react_1.default.createElement(exports.Message,null,"Oops… Data fetching failed."):data?react_1.default.createElement(Comp,__assign({},__assign(__assign({},props),((_a={})[propName]=this.state.data,_a)))):react_1.default.createElement(exports.Message,null,"Fetching data…")},Fetcher}(react_1.default.Component);return react_1.default.createElement(Fetcher,null)}}};exports.withFetchCsv=function(propName,url){return withFetch("csv",propName,url)},exports.withFetchJson=function(propName,url){return withFetch("json",propName,url)}},307:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__importStar(__webpack_require__(8)),stats_js_1=__importDefault(__webpack_require__(769));exports.default=function withStats(Comp){return function(props){var WithStats=function(_super){function WithStats(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.stats=new stats_js_1.default,_this.statsContainer=React.createRef(),_this.animateRef=0,_this}return __extends(WithStats,_super),WithStats.prototype.componentDidMount=function(){var _this=this;this.statsContainer.current&&(this.stats.showPanel(0),this.statsContainer.current.appendChild(this.stats.dom));var calcFPS=function(){_this.stats.begin(),_this.stats.end(),_this.animateRef=window.requestAnimationFrame(calcFPS)};this.animateRef=window.requestAnimationFrame(calcFPS)},WithStats.prototype.componentWillUnmount=function(){window.cancelAnimationFrame(this.animateRef)},WithStats.prototype.render=function(){return React.createElement(React.Fragment,null,React.createElement(Comp,__assign({},props)),React.createElement("div",{ref:this.statsContainer}))},WithStats}(React.Component);return React.createElement(WithStats,null)}}},312:function(module,exports){},34:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var extendStatics,PickingType,composite_layer=__webpack_require__(418),geojson_layer=__webpack_require__(793),lib_layer=__webpack_require__(153),src=__webpack_require__(107),model=__webpack_require__(255),geometry=__webpack_require__(430),__extends=(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},DEFAULT_COLOR=[0,132,193,255],dist_esm_AnimatedFlowLinesLayer_AnimatedFlowLinesLayer=function(_super){function AnimatedFlowLinesLayer(props){return _super.call(this,props,null)||this}return __extends(AnimatedFlowLinesLayer,_super),AnimatedFlowLinesLayer.prototype.getShaders=function(){return{vs:"#define SHADER_NAME animated-flow-lines-layer-vertex-shader\n#define SPEED 0.015\n#define NUM_PARTS 5.0\n#define DIR_OFFSET 0.0 \n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceSourceTargetPositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceStaggering;\nattribute float instancePickable;\n         \nuniform float opacity;\nuniform float currentTime;\nuniform float thicknessUnit;\n    \nvarying vec4 vColor;\nvarying float sourceToTarget;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths * thicknessUnit;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  // Position\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, vec2(0.), vec3(0.));\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, vec2(0.), vec3(0.));\n\n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n\n  // extrude\n  vec2 offset = getExtrusionOffset(target.xy - source.xy, positions.y - DIR_OFFSET);\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n\n  // Color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; \n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  if (instancePickable > 0.5) {\n    picking_setPickingColor(instancePickingColors);\n  }\n}\n",fs:"#define SHADER_NAME animated-flow-lines-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float sourceToTarget;\n\nvoid main(void) {\n  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(0.3, 1.0, fract(sourceToTarget)));\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:["project32","picking"]}},AnimatedFlowLinesLayer.prototype.draw=function(_a){var uniforms=_a.uniforms,_b=this.props,currentTime=_b.currentTime,thicknessUnit=_b.thicknessUnit;this.state.model.setUniforms(__assign(__assign({},uniforms),{thicknessUnit:3*thicknessUnit,currentTime:currentTime})).draw()},AnimatedFlowLinesLayer.prototype.initializeState=function(){var gl=this.context.gl;this.setState({model:this.createModel(gl)}),this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:src.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})},AnimatedFlowLinesLayer.prototype.createModel=function(gl){return new model.a(gl,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new geometry.a({drawMode:src.TRIANGLE_STRIP,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))},AnimatedFlowLinesLayer.defaultProps={currentTime:0,getSourcePosition:{type:"accessor",value:function(d){return d.sourcePosition}},getTargetPosition:{type:"accessor",value:function(d){return d.targetPosition}},getPickable:{type:"accessor",value:function(d){return 1}},getStaggering:{type:"accessor",value:function(d,_a){_a.index;return Math.random()}},getColor:{type:"accessor",value:DEFAULT_COLOR},getThickness:{type:"accessor",value:1},thicknessUnit:30,parameters:{depthTest:!1}},AnimatedFlowLinesLayer}(lib_layer.a),FlowCirclesLayer_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),dist_esm_FlowCirclesLayer_FlowCirclesLayer=function(_super){function FlowCirclesLayer(props){return _super.call(this,props)||this}return FlowCirclesLayer_extends(FlowCirclesLayer,_super),FlowCirclesLayer.prototype.getShaders=function(){return{vs:"#define SHADER_NAME flow-circles-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  \n  // Find the center of the point and add the current vertex\n  vec3 offset = positions * instanceRadius;\n  gl_Position = project_position_to_clipspace(instancePositions, vec2(0.), offset);\n  \n  // Apply opacity to instance color, or return instance picking color\n  vColor = instanceColors / 255.;\n  \n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME flow-circles-layer-fragment-shader\n#define SOFT_OUTLINE 0.1\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n// varying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0 /* || distToCenter < innerUnitRadius*/) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  \n  float soften = smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);\n  gl_FragColor = vec4(vColor.rgb, vColor.a * soften);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:["project32","picking"],shaderCache:this.context.shaderCache}},FlowCirclesLayer.prototype.initializeState=function(){var gl=this.context.gl;this.setState({model:this.createModel(gl)}),this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:src.UNSIGNED_BYTE,accessor:"getColor",defaultValue:[0,0,0,255]}})},FlowCirclesLayer.prototype.createModel=function(gl){return new model.a(gl,Object.assign(this.getShaders(),{id:this.props.id,geometry:new geometry.a({drawMode:src.TRIANGLE_FAN,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))},FlowCirclesLayer.layerName="FlowCirclesLayer",FlowCirclesLayer.defaultProps={parameters:{depthTest:!1}},FlowCirclesLayer}(lib_layer.a),FlowLinesLayer_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),FlowLinesLayer_assign=function(){return(FlowLinesLayer_assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},FlowLinesLayer_DEFAULT_COLOR=[0,132,193,255],dist_esm_FlowLinesLayer_FlowLinesLayer=function(_super){function FlowLinesLayer(props){return _super.call(this,props)||this}return FlowLinesLayer_extends(FlowLinesLayer,_super),FlowLinesLayer.prototype.getShaders=function(){return{vs:"#define SHADER_NAME flow-line-layer-vertex-shader\n#define PI 3.1415926535897932384626433832795\n\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 instanceColors;\nattribute float instanceThickness;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceEndpointOffsets;\nattribute float instancePickable;\n\nuniform vec4 outlineColor;\nuniform float thicknessUnit;\nuniform float gap;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nmat2 rotation_mat2(float a) {\n  return mat2(cos(a), sin(a), -sin(a), cos(a));\n}\n\nvec2 vec3_to_vec2(vec3 a) {\n  return vec2(a[0], a[1]);\n}\n\nvoid main(void) {\n  vec2 projectedSourceCoord = vec3_to_vec2(project_position(instanceSourcePositions));\n  vec2 projectedTargetCoord = vec3_to_vec2(project_position(instanceTargetPositions));\n\n\n  vec2 sourceTarget = projectedTargetCoord - projectedSourceCoord;\n  float offsetLimit = length(sourceTarget) * 0.8;\n  vec2 flowlineDirection = normalize(sourceTarget);\n  vec2 limitedOffsetDistances = clamp(positions.yz * thicknessUnit, -offsetLimit, offsetLimit);\n  float endpointOffset = mix(instanceEndpointOffsets.x, -instanceEndpointOffsets.y, positions.x);\n  vec2 offset =\n    rotation_mat2(0.5*PI) * flowlineDirection * (instanceThickness * limitedOffsetDistances[0] + gap + normals.x) +\n    flowlineDirection * (instanceThickness * limitedOffsetDistances[1] + normals.y + endpointOffset)\n  ;\n\n\n  vec2 mixed_temp = mix(projectedSourceCoord, projectedTargetCoord, positions.x);\n\n  vec4 vertex_pos_modelspace;\n\n  vertex_pos_modelspace[0] = mixed_temp[0] + offset[0];\n  vertex_pos_modelspace[1] = mixed_temp[1] + offset[1];\n  vertex_pos_modelspace[2] = 0.0;\n  vertex_pos_modelspace[3] = 1.0;\n\n\n  gl_Position = project_common_position_to_clipspace(vertex_pos_modelspace);\n  \n  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  \n  if (instancePickable <= 0.5) {\n    vColor = mix(fillColor, vec4(outlineColor.xyz, instanceThickness), normals.z);\n  } else {\n    vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);\n  }\n  \n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  if (instancePickable > 0.5) {\n    picking_setPickingColor(instancePickingColors);\n  }\n}\n",fs:"#define SHADER_NAME flow-line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  if (vColor.a == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  \n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  \n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:["project32","picking"],shaderCache:this.context.shaderCache}},FlowLinesLayer.prototype.initializeState=function(){var gl=this.context.gl;this.setState({model:this.createModel(gl)}),this.state.attributeManager.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:src.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})},FlowLinesLayer.prototype.draw=function(_a){var uniforms=_a.uniforms,gl=this.context.gl,_b=this.props,outlineColor=_b.outlineColor,thicknessUnit=_b.thicknessUnit;gl.lineWidth(1),this.state.model.setUniforms(FlowLinesLayer_assign(FlowLinesLayer_assign({},uniforms),{outlineColor:outlineColor.map((function(x){return x/255})),thicknessUnit:2*thicknessUnit,gap:.75})).draw()},FlowLinesLayer.prototype.createModel=function(gl){var positions=[],pixelOffsets=[],_a=this.props,drawOutline=_a.drawOutline,outlineThickness=_a.outlineThickness;if(drawOutline){positions=positions.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]);var tout=outlineThickness;pixelOffsets=pixelOffsets.concat([-1,-tout,1,tout,-tout,1,-1,tout,1,tout,-tout,1,-1,0,1,tout,0,1,-1,3*tout,1,2*tout,-tout,1,-1,-tout,1])}return positions=positions.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]),pixelOffsets=pixelOffsets.concat([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),new model.a(gl,FlowLinesLayer_assign(FlowLinesLayer_assign({id:this.props.id},this.getShaders()),{geometry:new geometry.a({drawType:src.TRIANGLES,attributes:{positions:new Float32Array(positions),normals:new Float32Array(pixelOffsets)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))},FlowLinesLayer.layerName="FlowLinesLayer",FlowLinesLayer.defaultProps={getSourcePosition:{type:"accessor",value:function(d){return d.sourcePosition}},getTargetPosition:{type:"accessor",value:function(d){return d.targetPosition}},getColor:{type:"accessor",value:FlowLinesLayer_DEFAULT_COLOR},getThickness:{type:"accessor",value:function(d){return d.thickness}},getPickable:{type:"accessor",value:function(d){return 1}},drawOutline:!0,thicknessUnit:15,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}},FlowLinesLayer}(lib_layer.a),extent=__webpack_require__(789),max=__webpack_require__(790),ascending=__webpack_require__(252),d3_collection_src=__webpack_require__(437),linear=__webpack_require__(162),pow=__webpack_require__(432),es=__webpack_require__(41),lab=__webpack_require__(786),src_color=__webpack_require__(59),d3_interpolate_src=__webpack_require__(54),sequential=__webpack_require__(794),colors_assign=function(){return(colors_assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},DEFAULT_FLOW_COLOR_SCHEME=["rgba(240,240,240,0.5)","#137CBD"],DEFAULT_FLOW_COLOR_SCHEME_POSITIVE=["rgba(240,240,240,0.5)","#f6654e"],DEFAULT_FLOW_COLOR_SCHEME_NEGATIVE=["rgba(240,240,240,0.5)","#00a9cc"],DEFAULT_OUTLINE_COLOR="#fff",DEFAULT_LOCATION_AREA_COLOR="rgba(220,220,220,0.5)",DEFAULT_DIMMED_OPACITY=.4,CIRCLE_DIMMED_OPACITY_MULTIPLIER=.5,FALLBACK_COLOR_RGBA=[255,255,255,255];function isDiffColorsRGBA(colors){return void 0!==colors.positive}function getBaseColorsRGBA(colors){var darkMode=!(!colors||!colors.darkMode);return{darkMode:darkMode,locationAreas:getLocationAreaColorsRGBA(colors&&colors.locationAreas,darkMode),outlineColor:colorAsRgba(colors&&colors.outlineColor||DEFAULT_OUTLINE_COLOR),dimmedOpacity:colors&&null!=colors.dimmedOpacity?colors.dimmedOpacity:DEFAULT_DIMMED_OPACITY}}function getColorsRGBA(colors){var baseColorsRGBA=getBaseColorsRGBA(colors);return colors_assign(colors_assign({},baseColorsRGBA),getFlowAndCircleColors(colors,DEFAULT_FLOW_COLOR_SCHEME,baseColorsRGBA.darkMode))}function getDiffColorsRGBA(colors){var baseColorsRGBA=getBaseColorsRGBA(colors);return colors_assign(colors_assign({},baseColorsRGBA),{positive:getFlowAndCircleColors(colors&&colors.positive,DEFAULT_FLOW_COLOR_SCHEME_POSITIVE,baseColorsRGBA.darkMode),negative:getFlowAndCircleColors(colors&&colors.negative,DEFAULT_FLOW_COLOR_SCHEME_NEGATIVE,baseColorsRGBA.darkMode)})}function getLocationAreaColorsRGBA(colors,darkMode){var normalColor=colors&&colors.normal||DEFAULT_LOCATION_AREA_COLOR,normalColorHcl=Object(lab.b)(normalColor),locationAreasNormal=colorAsRgba(normalColor);return{normal:locationAreasNormal,connected:colorAsRgbaOr(colors&&colors.connected,locationAreasNormal),highlighted:colorAsRgbaOr(colors&&colors.highlighted,opacifyHex(normalColorHcl[darkMode?"brighter":"darker"](1).toString(),.5)),selected:colorAsRgbaOr(colors&&colors.selected,opacifyHex(normalColorHcl[darkMode?"brighter":"darker"](2).toString(),.8)),outline:colorAsRgbaOr(colors&&colors.outline,colorAsRgba(normalColorHcl[darkMode?"brighter":"darker"](4).toString()))}}function getFlowAndCircleColors(inputColors,defaultFlowColorScheme,darkMode){var flowColorScheme=inputColors&&inputColors.flows&&inputColors.flows.scheme||defaultFlowColorScheme,maxFlowColorHcl=Object(lab.b)(flowColorScheme[flowColorScheme.length-1]),flowColorHighlighted=colorAsRgbaOr(inputColors&&inputColors.flows&&inputColors.flows.highlighted,colorAsRgba(maxFlowColorHcl[darkMode?"brighter":"darker"](.7).toString()));return{flows:{scheme:flowColorScheme,highlighted:flowColorHighlighted},locationCircles:{inner:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.inner,maxFlowColorHcl.toString()),outgoing:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.outgoing,darkMode?"#000":"#fff"),incoming:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.incoming,maxFlowColorHcl[darkMode?"brighter":"darker"](1.25).toString()),highlighted:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.highlighted,flowColorHighlighted)}}}function colorAsRgba(color){var col=Object(src_color.e)(color);if(!col)return console.warn("Invalid color: ",color),FALLBACK_COLOR_RGBA;var rgbColor=col.rgb();return[Math.floor(rgbColor.r),Math.floor(rgbColor.g),Math.floor(rgbColor.b),opacityFloatToInteger(col.opacity)]}function colorAsRgbaOr(color,defaultColor){return color?colorAsRgba(color):"string"==typeof defaultColor?colorAsRgba(defaultColor):defaultColor}function rgbaAsString(color){return"rgba("+color.join(",")+")"}function opacifyHex(hexCode,opacity){var c=Object(src_color.e)(hexCode);if(!c)return console.warn("Invalid color: ",hexCode),"rgba(255, 255, 255, "+opacity+")";var col=c.rgb();return"rgba("+col.r+", "+col.g+", "+col.b+", "+opacity+")"}function opacityFloatToInteger(opacity){return Math.round(255*opacity)}function getDimmedColor(color,opacity){var col=Object(lab.b)(rgbaAsString(color));if(!col)return console.warn("Invalid color: ",color),FALLBACK_COLOR_RGBA;col.c*=.1;var rgbColor=col.rgb();return[Math.floor(rgbColor.r),Math.floor(rgbColor.g),Math.floor(rgbColor.b),opacityFloatToInteger(void 0!==opacity?opacity:DEFAULT_DIMMED_OPACITY)]}function createFlowColorScale(domain,scheme,animate){var scale=Object(sequential.a)(Object(d3_interpolate_src.d)(scheme)).exponent(animate?.5:1/3).domain(domain);return function(value){return colorAsRgba(scale(value))}}function isFeatureCollection(locations){return"FeatureCollection"===locations.type}!function(PickingType){PickingType.LOCATION="location",PickingType.FLOW="flow",PickingType.LOCATION_AREA="location-area"}(PickingType||(PickingType={}));var LayerKind,CIRCLE_OUTLINE_THICKNESS=1,getDiffMode=function(props){return props.diffMode},getColorsProp=function(props){return props.colors},getAnimate=function(props){return props.animate},getLocationFeatures=function(props){return isFeatureCollection(props.locations)?props.locations.features:props.locations},getFlows=function(props){return props.flows},getHighlightedFlow=function(props){return props.highlightedFlow},getHighlightedLocationId=function(props){return props.highlightedLocationId},getSelectedLocationIds=function(props){return props.selectedLocationIds},getShowOnlyTopFlows=function(props){return props.showOnlyTopFlows},dist_esm_Selectors=function(){function Selectors(inputAccessors){var _this=this;this.inputAccessors=inputAccessors,this.getColors=Object(es.a)([getColorsProp,getDiffMode],(function(colors,diffMode){return diffMode?getDiffColorsRGBA(colors):getColorsRGBA(colors)})),this.getLocationByIdGetter=Object(es.a)([getLocationFeatures],(function(locations){var locationsById=Object(d3_collection_src.a)().key(_this.inputAccessors.getLocationId).rollup((function(_a){return _a[0]})).object(locations);return function(id){var location=locationsById[id];return location||console.warn("No location found for id '"+id+"'"),location}})),this.getFilteredFlows=Object(es.a)([getFlows,getSelectedLocationIds],(function(flows,selectedLocationIds){var _a=_this.inputAccessors,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;return selectedLocationIds?flows.filter((function(flow){return selectedLocationIds.indexOf(getFlowOriginId(flow))>=0||selectedLocationIds.indexOf(getFlowDestId(flow))>=0})):flows})),this.getNonSelfFlows=Object(es.a)([this.getFilteredFlows],(function(flows){var _a=_this.inputAccessors,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;return flows.filter((function(flow){return getFlowOriginId(flow)!==getFlowDestId(flow)}))})),this.getSortedNonSelfFlows=Object(es.a)([this.getNonSelfFlows],(function(flows){return flows.slice().sort((function(f1,f2){return Math.abs(_this.inputAccessors.getFlowMagnitude(f1))-Math.abs(_this.inputAccessors.getFlowMagnitude(f2))}))})),this.getTopFlows=Object(es.a)([this.getSortedNonSelfFlows,getShowOnlyTopFlows],(function(flows,showOnlyTopFlows){return null!=showOnlyTopFlows&&showOnlyTopFlows>0&&flows.length>showOnlyTopFlows?flows.slice(flows.length-showOnlyTopFlows,flows.length):flows})),this.getHighlightedFlows=Object(es.a)([this.getSortedNonSelfFlows,getHighlightedFlow,getHighlightedLocationId],(function(flows,highlightedFlow,highlightedLocationId){var _a=_this.inputAccessors,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;return highlightedFlow?[highlightedFlow]:highlightedLocationId?flows.filter((function(flow){return getFlowOriginId(flow)===highlightedLocationId||getFlowDestId(flow)===highlightedLocationId})):void 0})),this.getFlowMagnitudeExtent=Object(es.a)([this.getNonSelfFlows],(function(flows){return Object(extent.a)(flows,_this.inputAccessors.getFlowMagnitude)})),this.getFlowThicknessScale=Object(es.a)([this.getFlowMagnitudeExtent],(function(_a){var minMagnitude=_a[0],maxMagnitude=_a[1],scale=Object(linear.a)().range([.05,.5]).domain([0,Math.max(Math.abs(minMagnitude||0),Math.abs(maxMagnitude||0))]);return function(magnitude){return scale(Math.abs(magnitude))}})),this.getFlowColorScale=Object(es.a)([this.getColors,this.getFlowMagnitudeExtent,getAnimate],(function(colors,_a,animate){var minMagnitude=_a[0],maxMagnitude=_a[1];if(isDiffColorsRGBA(colors)){var posScale_1=createFlowColorScale([0,maxMagnitude||0],colors.positive.flows.scheme,animate),negScale_1=createFlowColorScale([0,minMagnitude||0],colors.negative.flows.scheme,animate);return function(magnitude){return magnitude>=0?posScale_1(magnitude):negScale_1(magnitude)}}var scale=createFlowColorScale([0,maxMagnitude||0],colors.flows.scheme,animate);return function(magnitude){return scale(magnitude)}})),this.getLocationTotals=Object(es.a)([getLocationFeatures,this.getFilteredFlows],(function(locations,flows){var _a=_this.inputAccessors,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude;return flows.reduce((function(acc,curr){var originId=getFlowOriginId(curr),destId=getFlowDestId(curr),magnitude=getFlowMagnitude(curr);return originId===destId?acc.within[originId]=(acc.within[originId]||0)+magnitude:(acc.outgoing[originId]=(acc.outgoing[originId]||0)+magnitude,acc.incoming[destId]=(acc.incoming[destId]||0)+magnitude),acc}),{incoming:{},outgoing:{},within:{}})})),this.getHighlightedLocationCircles=Object(es.a)([this.getLocationByIdGetter,getHighlightedLocationId],(function(getLocationById,highlightedLocationId){if(highlightedLocationId){var location_1=getLocationById(highlightedLocationId);if(!location_1)return;return[{location:location_1,type:"outline"},{location:location_1,type:"outer"},{location:location_1,type:"inner"}]}})),this.getLocationTotalInGetter=function(props){var _a=_this.inputAccessors,getLocationTotalIn=_a.getLocationTotalIn,getLocationId=_a.getLocationId;if(getLocationTotalIn)return getLocationTotalIn;var incoming=_this.getLocationTotals(props).incoming;return function(location){return incoming[getLocationId(location)]||0}},this.getLocationTotalOutGetter=function(props){var _a=_this.inputAccessors,getLocationTotalOut=_a.getLocationTotalOut,getLocationId=_a.getLocationId;if(getLocationTotalOut)return getLocationTotalOut;var outgoing=_this.getLocationTotals(props).outgoing;return function(location){return outgoing[getLocationId(location)]||0}},this.getLocationTotalWithinGetter=function(props){var _a=_this.inputAccessors,getLocationTotalWithin=_a.getLocationTotalWithin,getLocationId=_a.getLocationId;if(getLocationTotalWithin)return getLocationTotalWithin;var within=_this.getLocationTotals(props).within;return function(location){return within[getLocationId(location)]||0}},this.getLocationMaxAbsTotalGetter=Object(es.a)([getLocationFeatures,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(function(locations,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin){return function(location){return Math.max(Math.abs(getLocationTotalIn(location)+getLocationTotalWithin(location)),Math.abs(getLocationTotalOut(location)+getLocationTotalWithin(location)))}})),this.getMaxLocationMaxAbsTotal=Object(es.a)([getLocationFeatures,this.getLocationMaxAbsTotalGetter],(function(locations,getLocationMaxAbsTotal){return Object(max.a)(locations,getLocationMaxAbsTotal)||0})),this.getLocationCircles=Object(es.a)([getLocationFeatures,this.getLocationMaxAbsTotalGetter],(function(locations,getLocationMaxAbsTotalGetter){for(var circles=[],_i=0,sorted_1=locations.slice().sort((function(a,b){return Object(ascending.a)(getLocationMaxAbsTotalGetter(a),getLocationMaxAbsTotalGetter(b))}));_i<sorted_1.length;_i++){var location_2=sorted_1[_i];circles.push({location:location_2,type:"outline"}),circles.push({location:location_2,type:"outer"}),circles.push({location:location_2,type:"inner"})}return circles})),this.getSizeScale=Object(es.a)([this.getMaxLocationMaxAbsTotal],(function(maxTotal){var scale=Object(pow.a)().exponent(.5).domain([0,maxTotal]).range([0,maxTotal>0?15:1]);return function(v){return scale(Math.abs(v))}})),this.getLocationCircleRadiusGetter=Object(es.a)([this.getSizeScale,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(function(sizeScale,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin){return function(_a){var location=_a.location,type=_a.type,getSide="inner"===type?Math.min:Math.max,totalIn=getLocationTotalIn(location),totalOut=getLocationTotalOut(location),totalWithin=getLocationTotalWithin(location),r=sizeScale(getSide(Math.abs(totalIn+totalWithin),Math.abs(totalOut+totalWithin)));return"outline"===type?r+CIRCLE_OUTLINE_THICKNESS:r}})),this.getLocationCircleColorGetter=Object(es.a)([this.getColors,getHighlightedLocationId,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(function(colors,highlightedLocationId,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin){var getLocationId=_this.inputAccessors.getLocationId;return function(_a){var location=_a.location,type=_a.type,isHighlighted=highlightedLocationId&&highlightedLocationId===getLocationId(location),isDimmed=highlightedLocationId&&highlightedLocationId!==getLocationId(location),totalWithin=getLocationTotalWithin(location),totalIn=getLocationTotalIn(location)+totalWithin,totalOut=getLocationTotalOut(location)+totalWithin,isIncoming="outer"===type&&Math.abs(totalIn)>Math.abs(totalOut),isPositive=!0===isIncoming&&totalIn>=0||totalOut>=0,circleColors=(isDiffColorsRGBA(colors)?isPositive?colors.positive:colors.negative:colors).locationCircles;return isHighlighted&&"outline"===type?circleColors.highlighted:isDimmed?"outline"===type?function getDimmedCircleOutlineColor(outlineColor,opacity){return[outlineColor[0],outlineColor[1],outlineColor[2],outlineColor[3]*opacity*CIRCLE_DIMMED_OPACITY_MULTIPLIER]}(colors.outlineColor,colors.dimmedOpacity):function getDimmedCircleColor(color,opacity){return getDimmedColor(color,opacity*CIRCLE_DIMMED_OPACITY_MULTIPLIER)}(circleColors.inner,colors.dimmedOpacity):"outline"===type?isIncoming?circleColors.incoming:circleColors.inner:"inner"===type?circleColors.inner:!0===isIncoming?circleColors.incoming:circleColors.outgoing}})),this.isLocationConnectedGetter=Object(es.a)([this.getFilteredFlows,getHighlightedLocationId,getHighlightedFlow,getSelectedLocationIds],(function(flows,highlightedLocationId,highlightedFlow,selectedLocationIds){var _a=_this.inputAccessors,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId;if(highlightedLocationId){for(var isRelated=function(flow){var originId=getFlowOriginId(flow),destId=getFlowDestId(flow);return originId===highlightedLocationId||selectedLocationIds&&selectedLocationIds.indexOf(originId)>=0||destId===highlightedLocationId||selectedLocationIds&&selectedLocationIds.indexOf(destId)>=0},locations_1=new Set,_i=0,flows_1=flows;_i<flows_1.length;_i++){var flow=flows_1[_i];isRelated(flow)&&(locations_1.add(getFlowOriginId(flow)),locations_1.add(getFlowDestId(flow)))}return function(id){return locations_1.has(id)}}return function(){return!1}})),this.getLocationAreaFillColorGetter=Object(es.a)([this.getColors,getSelectedLocationIds,this.isLocationConnectedGetter],(function(colors,selectedLocationIds,isLocationConnected){return function(location){var locationId=_this.inputAccessors.getLocationId(location);return selectedLocationIds&&selectedLocationIds.indexOf(locationId)>=0?colors.locationAreas.selected:isLocationConnected(locationId)?colors.locationAreas.connected:colors.locationAreas.normal}}))}return Selectors.prototype.getFlowLinesColorGetter=function(colors,flowColorScale,highlighted,dimmed){var _a=this.inputAccessors,getFlowMagnitude=_a.getFlowMagnitude,getFlowColor=_a.getFlowColor;return function(flow){if(getFlowColor&&(color=getFlowColor(flow)))return colorAsRgba(color);if(highlighted){if(isDiffColorsRGBA(colors)){var positiveColor=colors.positive.flows.highlighted,negativeColor=colors.negative.flows.highlighted;return(magnitude=getFlowMagnitude(flow))>=0?positiveColor:negativeColor}return colors.flows.highlighted}var magnitude=getFlowMagnitude(flow),color=flowColorScale(magnitude);return dimmed?getDimmedColor(color,colors.dimmedOpacity):color}},Selectors.prototype.setInputAccessors=function(inputAccessors){this.inputAccessors=inputAccessors},Selectors.prototype.getInputAccessors=function(){return this.inputAccessors},Selectors}(),FlowMapLayer_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),FlowMapLayer_assign=function(){return(FlowMapLayer_assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};!function(LayerKind){LayerKind.LOCATIONS="LOCATIONS",LayerKind.LOCATION_AREAS="LOCATION_AREAS",LayerKind.LOCATION_AREAS_OUTLINES="LOCATION_AREAS_OUTLINES",LayerKind.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED="LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED",LayerKind.FLOWS="FLOWS",LayerKind.LOCATIONS_HIGHLIGHTED="LOCATIONS_HIGHLIGHTED",LayerKind.FLOWS_HIGHLIGHTED="FLOWS_HIGHLIGHTED"}(LayerKind||(LayerKind={}));var LAYER_ID_SEPARATOR=":::";function getLayerId(baseLayerId,layerKind){return""+baseLayerId+LAYER_ID_SEPARATOR+layerKind.valueOf()}function getPickType(_a){switch(function getLayerKind(id){var kind=id.substr(id.lastIndexOf(LAYER_ID_SEPARATOR)+LAYER_ID_SEPARATOR.length);return LayerKind[kind]}(_a.id)){case LayerKind.FLOWS:case LayerKind.FLOWS_HIGHLIGHTED:return PickingType.FLOW;case LayerKind.LOCATIONS:case LayerKind.LOCATIONS_HIGHLIGHTED:return PickingType.LOCATION;case LayerKind.LOCATION_AREAS:return PickingType.LOCATION_AREA;default:return}}var dist_esm_FlowMapLayer=function(_super){function FlowMapLayer(props){return _super.call(this,props)||this}return FlowMapLayer_extends(FlowMapLayer,_super),FlowMapLayer.prototype.initializeState=function(){var _a=this.props,getLocationTotalIn=_a.getLocationTotalIn,getLocationTotalOut=_a.getLocationTotalOut,getLocationTotalWithin=_a.getLocationTotalWithin,getLocationId=_a.getLocationId,getLocationCentroid=_a.getLocationCentroid,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,getFlowColor=_a.getFlowColor,selectors=new dist_esm_Selectors({getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getLocationTotalWithin:getLocationTotalWithin,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor});this.setState({selectors:selectors})},FlowMapLayer.prototype.updateState=function(params){_super.prototype.updateState.call(this,params);var props=params.props;if(params.changeFlags.propsChanged){var getLocationTotalIn=props.getLocationTotalIn,getLocationTotalOut=props.getLocationTotalOut,getLocationTotalWithin=props.getLocationTotalWithin,getLocationId=props.getLocationId,getLocationCentroid=props.getLocationCentroid,getFlowOriginId=props.getFlowOriginId,getFlowDestId=props.getFlowDestId,getFlowMagnitude=props.getFlowMagnitude,getFlowColor=props.getFlowColor;this.state.selectors.setInputAccessors({getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getLocationTotalWithin:getLocationTotalWithin,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor})}},FlowMapLayer.prototype.getPickingInfo=function(params){var type=getPickType(params.sourceLayer);if(!type)return params.info;var info=FlowMapLayer_assign(FlowMapLayer_assign({},params.info),{type:type}),selectors=this.state.selectors;if(type===PickingType.FLOW){var getLocationById=selectors.getLocationByIdGetter(this.props),_a=selectors.getInputAccessors(),getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,flow=info.object;return FlowMapLayer_assign(FlowMapLayer_assign({},info),flow&&{origin:getLocationById(getFlowOriginId(flow)),dest:getLocationById(getFlowDestId(flow))})}if(type===PickingType.LOCATION||type===PickingType.LOCATION_AREA){var location_1=type===PickingType.LOCATION?info.object&&info.object.location:info.object,getLocationTotalIn=selectors.getLocationTotalInGetter(this.props),getLocationTotalOut=selectors.getLocationTotalOutGetter(this.props),getLocationTotalWithin=selectors.getLocationTotalWithinGetter(this.props),getLocationCircleRadius=selectors.getLocationCircleRadiusGetter(this.props);return FlowMapLayer_assign(FlowMapLayer_assign({},info),location_1&&{object:location_1,totalIn:getLocationTotalIn(location_1),totalOut:getLocationTotalOut(location_1),totalWithin:getLocationTotalWithin(location_1),circleRadius:getLocationCircleRadius({location:location_1,type:"outer"})})}return info},FlowMapLayer.prototype.renderLayers=function(){var _a=this.props,showLocationAreas=_a.showLocationAreas,locations=_a.locations,highlightedLocationId=_a.highlightedLocationId,selectors=this.state.selectors,topFlows=selectors.getTopFlows(this.props),highlightedFlows=selectors.getHighlightedFlows(this.props),isLocationHighlighted=null!=highlightedLocationId,locationCircles=selectors.getLocationCircles(this.props),layers=[];if(showLocationAreas&&isFeatureCollection(locations)&&layers.push(this.getLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS),!1)),layers.push(this.getFlowLinesLayer(getLayerId(this.props.id,LayerKind.FLOWS),topFlows,!1,isLocationHighlighted)),showLocationAreas&&isFeatureCollection(locations)&&layers.push(this.getHighlightedLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED))),highlightedFlows&&layers.push(this.getFlowLinesLayer(getLayerId(this.props.id,LayerKind.FLOWS_HIGHLIGHTED),highlightedFlows,!0,!1)),layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id,LayerKind.LOCATIONS),locationCircles,!1)),isLocationHighlighted){var highlightedLocationCircles=selectors.getHighlightedLocationCircles(this.props);layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id,LayerKind.LOCATIONS_HIGHLIGHTED),highlightedLocationCircles,!0))}return showLocationAreas&&isFeatureCollection(locations)&&layers.push(this.getLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS_OUTLINES),!0)),layers},FlowMapLayer.prototype.getLocationAreasLayer=function(id,outline){var _a=this.props,locations=_a.locations,selectedLocationIds=_a.selectedLocationIds,highlightedLocationId=_a.highlightedLocationId,highlightedFlow=_a.highlightedFlow,selectors=this.state.selectors,colors=selectors.getColors(this.props);return new geojson_layer.a({id:id,getFillColor:selectors.getLocationAreaFillColorGetter(this.props),getLineColor:colors.locationAreas.outline,lineJointRounded:!0,data:locations,stroked:outline,filled:!outline,pickable:!outline,opacity:1,lineWidthMinPixels:1,pointRadiusMinPixels:1,updateTriggers:outline?{}:{getFillColor:{selectedLocationIds:selectedLocationIds,highlightedLocationId:highlightedLocationId,highlightedFlow:highlightedFlow}}})},FlowMapLayer.prototype.getHighlightedLocationAreasLayer=function(id){var selectors=this.state.selectors,_a=this.props,highlightedLocationId=_a.highlightedLocationId,highlightedLocationAreaId=_a.highlightedLocationAreaId,colors=selectors.getColors(this.props),getLocationById=selectors.getLocationByIdGetter(this.props);return new geojson_layer.a({id:id,getFillColor:function(){return colors.locationAreas.highlighted},getLineColor:colors.locationAreas.outline,lineJointRounded:!0,data:highlightedLocationId?getLocationById(highlightedLocationId):highlightedLocationAreaId?getLocationById(highlightedLocationAreaId):void 0,stroked:!1,filled:!0,pickable:!1,opacity:1,lineWidthMinPixels:5})},FlowMapLayer.prototype.getFlowLinesLayer=function(id,flows,highlighted,dimmed){var _a=this.props,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,getLocationCentroid=_a.getLocationCentroid,showTotals=_a.showTotals,locationCircleSize=_a.locationCircleSize,outlineThickness=_a.outlineThickness,minPickableFlowThickness=_a.minPickableFlowThickness,selectors=this.state.selectors,endpointOffsets=[(locationCircleSize||0)+1,(locationCircleSize||0)+1],getLocationRadius=selectors.getLocationCircleRadiusGetter(this.props),getLocationById=selectors.getLocationByIdGetter(this.props),flowThicknessScale=selectors.getFlowThicknessScale(this.props),getThickness=function(flow){return flowThicknessScale(getFlowMagnitude(flow))},flowColorScale=selectors.getFlowColorScale(this.props),colors=selectors.getColors(this.props),getColor=selectors.getFlowLinesColorGetter(colors,flowColorScale,highlighted,dimmed),animate=this.props.animate,thicknessUnit=null!=this.props.maxFlowThickness?this.props.maxFlowThickness:10,baseProps=FlowMapLayer_assign(FlowMapLayer_assign({id:id,getSourcePosition:function(flow){return getLocationCentroid(getLocationById(getFlowOriginId(flow)))},getTargetPosition:function(flow){return getLocationCentroid(getLocationById(getFlowDestId(flow)))},getThickness:getThickness,getEndpointOffsets:function(flow){return showTotals?[getLocationRadius({location:getLocationById(getFlowOriginId(flow)),type:"outline"}),getLocationRadius({location:getLocationById(getFlowDestId(flow)),type:"outline"})]:endpointOffsets},getColor:getColor,data:flows,opacity:1,pickable:!highlighted,drawOutline:!dimmed,updateTriggers:{getColor:{dimmed:dimmed},getEndpointOffsets:{showTotals:showTotals}},thicknessUnit:thicknessUnit,outlineColor:colors.outlineColor},outlineThickness&&{outlineThickness:outlineThickness}),null!=minPickableFlowThickness&&{getPickable:function(f){return thicknessUnit*getThickness(f)>=minPickableFlowThickness?1:0}});return animate?new dist_esm_AnimatedFlowLinesLayer_AnimatedFlowLinesLayer(FlowMapLayer_assign(FlowMapLayer_assign({},baseProps),{currentTime:this.props.animationCurrentTime})):new dist_esm_FlowLinesLayer_FlowLinesLayer(baseProps)},FlowMapLayer.prototype.getLocationCirclesLayer=function(id,circles,highlighted){var _this=this,_a=this.props,highlightedLocationId=_a.highlightedLocationId,selectedLocationIds=_a.selectedLocationIds,getLocationCentroid=_a.getLocationCentroid,flows=_a.flows,showTotals=_a.showTotals,selectors=this.state.selectors,getRadius=showTotals?selectors.getLocationCircleRadiusGetter(this.props):function(){return _this.props.locationCircleSize},getColor=selectors.getLocationCircleColorGetter(this.props);return new dist_esm_FlowCirclesLayer_FlowCirclesLayer({id:id,getColor:getColor,getPosition:function(locCircle){return getLocationCentroid(locCircle.location)},getRadius:getRadius,data:circles,opacity:1,pickable:!0,updateTriggers:{getRadius:{selectedLocationIds:selectedLocationIds,flows:flows},getColor:{highlightedLocationId:highlightedLocationId,selectedLocationIds:selectedLocationIds,flows:flows}}})},FlowMapLayer.layerName="FlowMapLayer",FlowMapLayer.defaultProps={getLocationId:{type:"accessor",value:function(l){return l.id||l.properties.id}},getLocationCentroid:{type:"accessor",value:function(l){return l.properties.centroid}},getFlowOriginId:{type:"accessor",value:function(f){return f.origin}},getFlowDestId:{type:"accessor",value:function(f){return f.dest}},getFlowMagnitude:{type:"accessor",value:function(f){return f.count}},showTotals:!0,locationCircleSize:3,outlineThickness:1,showLocationAreas:!0},FlowMapLayer}(composite_layer.a);__webpack_require__.d(__webpack_exports__,"isFeatureCollection",(function(){return isFeatureCollection})),__webpack_require__.d(__webpack_exports__,"PickingType",(function(){return PickingType})),__webpack_require__.d(__webpack_exports__,"getColorsRGBA",(function(){return getColorsRGBA})),__webpack_require__.d(__webpack_exports__,"getDiffColorsRGBA",(function(){return getDiffColorsRGBA})),__webpack_require__.d(__webpack_exports__,"isDiffColorsRGBA",(function(){return isDiffColorsRGBA})),__webpack_require__.d(__webpack_exports__,"rgbaAsString",(function(){return rgbaAsString}));__webpack_exports__.default=dist_esm_FlowMapLayer},417:function(module,exports,__webpack_require__){"use strict";(function(module){var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(427)),react_2=__webpack_require__(188),d3scaleChromatic=__importStar(__webpack_require__(771)),react_3=__importDefault(__webpack_require__(8)),NonInteractiveExample_1=__importDefault(__webpack_require__(767)),index_1=__webpack_require__(421),pipe_1=__importDefault(__webpack_require__(238)),withFetch_1=__webpack_require__(306),withStats_1=__importDefault(__webpack_require__(307)),getLocationId=function(loc){return loc.properties.abbr};react_2.storiesOf("Basic",module).add("basic",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("custom flow color scheme",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,colors={flows:{scheme:d3scaleChromatic.schemeGnBu[d3scaleChromatic.schemeGnBu.length-1]}};return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{colors:colors,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,{colors:colors})))}))).add("custom dark mode color scheme",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,colors={darkMode:!0,flows:{scheme:d3scaleChromatic.schemeGnBu[d3scaleChromatic.schemeGnBu.length-1].slice().reverse()},locationAreas:{normal:"#334"},outlineColor:"#000"};return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{colors:colors,mapStyle:"mapbox://styles/mapbox/dark-v10",mixBlendMode:"screen",getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10,style:{backgroundColor:"#000",color:"#fff"}},react_3.default.createElement(react_1.LocationTotalsLegend,{colors:colors})))}))).add("animated",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{animate:!0,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("only top 100 flows",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{getLocationId:getLocationId,showTotals:!0,showOnlyTopFlows:100,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("no location areas",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{colors:{outlineColor:"#fff"},getLocationId:getLocationId,showTotals:!0,showLocationAreas:!1,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("no location totals",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{getLocationId:getLocationId,showTotals:!1,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("custom zone totals",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,getTotal=(_a.flows,locations.features.map(getLocationId).reverse(),function(location){return 0});return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{getLocationId:getLocationId,flows:[],locations:locations,getLocationTotalIn:getTotal,getLocationTotalOut:getTotal,getLocationTotalWithin:getTotal,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("flow color override",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken,getFlowColor:function(f){if("ZH"===f.origin&&"AG"===f.dest)return"orange"}})}))).add("custom outlines",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{colors:{outlineColor:"#64e9f9"},getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),outlineThickness:5,mapboxAccessToken:index_1.mapboxAccessToken})}))).add("multiselect",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{getLocationId:getLocationId,flows:flows,locations:locations,multiselect:!0,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("non-interactive",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(NonInteractiveExample_1.default,{flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("difference mode",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-diff-2015-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{diffMode:!0,getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.DiffColorsLegend,null),react_3.default.createElement("hr",null),react_3.default.createElement(react_1.LocationTotalsLegend,{diff:!0})))}))).add("custom legend",(function(){return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.DiffColorsLegend,{positiveText:"+ diff",negativeText:"- diff"}),react_3.default.createElement("hr",null),react_3.default.createElement(react_1.LocationTotalsLegend,{diff:!0,aboutEqualText:"equal",moreOutgoingText:"> outgoing",moreIncomingText:"> incoming"})))})).add("maxFlowThickness",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{getLocationId:getLocationId,maxFlowThickness:15,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("maxFlowThickness animated",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{getLocationId:getLocationId,maxFlowThickness:15,flows:flows,animate:!0,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("minPickableFlowThickness",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{getLocationId:getLocationId,minPickableFlowThickness:1,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("minPickableFlowThickness animated",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{getLocationId:getLocationId,minPickableFlowThickness:1,animate:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))})))}).call(this,__webpack_require__(132)(module))},421:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(417),__webpack_require__(422),__webpack_require__(425),exports.mapboxAccessToken="pk.eyJ1IjoiaWx5YWJvLXRlcmFseXRpY3MiLCJhIjoiY2ppaW9wYzJ1MW8weTN2bnJkOHdsbTQ3dSJ9.VP2-bMLHPnmvqxkia-rM3g"},422:function(module,exports,__webpack_require__){"use strict";(function(module){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(188),react_2=__importDefault(__webpack_require__(8)),ClusteringExample_1=__importDefault(__webpack_require__(768)),pipe_1=__importDefault(__webpack_require__(238)),withFetch_1=__webpack_require__(306),withSheetsFetch_1=__importDefault(__webpack_require__(424)),withStats_1=__importDefault(__webpack_require__(307));react_1.storiesOf("Cluster on zoom",module).add("basic",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_2.default.createElement(ClusteringExample_1.default,{locations:locations,flows:flows,getLocationId:function(loc){return loc.properties.abbr},getLocationCentroid:function(loc){return loc.properties.centroid},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("NL commuters",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Oe3zM219uSfJ3sjdRT90SAK2kU3xIvzdcCW6cwTsAuc"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_2.default.createElement(ClusteringExample_1.default,{locations:locations,flows:flows,getLocationId:function(loc){return loc.id},getLocationCentroid:function(loc){return[+loc.lon,+loc.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})})))}).call(this,__webpack_require__(132)(module))},423:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(427)),react_2=__importDefault(__webpack_require__(8)),index_1=__webpack_require__(421),tooltipStyle={position:"absolute",pointerEvents:"none",zIndex:1,background:"#125",color:"#fff",fontSize:9,borderRadius:4,padding:5,maxWidth:300,maxHeight:300,overflow:"hidden",boxShadow:"2px 2px 4px #ccc"},Example=function(_super){function Example(props){var _this=_super.call(this,props)||this;_this.state={tooltip:void 0},_this.handleViewStateChange=function(viewState){var onViewStateChange=_this.props.onViewStateChange;onViewStateChange&&onViewStateChange(viewState),_this.state.tooltip&&_this.setState({tooltip:void 0})},_this.handleHighlight=function(highlight,info){info||_this.setState({tooltip:void 0}),_this.setState({tooltip:info})};var locations=props.locations,getLocationCentroid=props.getLocationCentroid;return _this.initialViewState=react_1.getViewStateForLocations(locations,getLocationCentroid,[window.innerWidth,window.innerHeight]),_this}return __extends(Example,_super),Example.prototype.renderTooltip=function(){var tooltip=this.state.tooltip;if(!tooltip)return null;var object=tooltip.object,x=tooltip.x,y=tooltip.y;return object?react_2.default.createElement("pre",{style:__assign(__assign({},tooltipStyle),{left:x,top:y})},JSON.stringify(object,null,2)):null},Example.prototype.render=function(){var _a=this.props,flows=_a.flows,locations=_a.locations,getLocationId=_a.getLocationId,getLocationCentroid=_a.getLocationCentroid,getFlowMagnitude=_a.getFlowMagnitude;return react_2.default.createElement(react_2.default.Fragment,null,react_2.default.createElement(react_1.default,{initialViewState:this.initialViewState,showTotals:!0,showLocationAreas:!1,showOnlyTopFlows:1e4,flows:flows,locations:locations,mapboxAccessToken:index_1.mapboxAccessToken,getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getFlowMagnitude:getFlowMagnitude,onViewStateChange:this.handleViewStateChange,onHighlighted:this.handleHighlight}),react_2.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_2.default.createElement(react_1.LocationTotalsLegend,null)),react_2.default.createElement(react_1.LegendBox,{bottom:35,right:10},"Showing "+(flows.length>1e4?"top 10000 of":"")+" "+flows.length+" flows. "),this.renderTooltip())},Example}(react_2.default.Component);exports.default=Example},424:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__importStar(__webpack_require__(8)),pipe_1=__importDefault(__webpack_require__(238)),withFetch_1=__webpack_require__(306);exports.default=function(sheetKey){return function(Comp){return function(props){var Fetcher=pipe_1.default(withFetch_1.withFetchCsv("locations","https://docs.google.com/spreadsheets/d/"+sheetKey+"/gviz/tq?tqx=out:csv&sheet=locations"),withFetch_1.withFetchCsv("flows","https://docs.google.com/spreadsheets/d/"+sheetKey+"/gviz/tq?tqx=out:csv&sheet=flows"))((function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(Comp,__assign({locations:locations,flows:flows,sheetKey:sheetKey},props))}));return React.createElement(Fetcher,null)}}}},425:function(module,exports,__webpack_require__){"use strict";(function(module){var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(188),React=__importStar(__webpack_require__(8)),Example_1=__importDefault(__webpack_require__(423)),pipe_1=__importDefault(__webpack_require__(238)),withSheetsFetch_1=__importDefault(__webpack_require__(424)),withStats_1=__importDefault(__webpack_require__(307));react_1.storiesOf("Other datasets",module).add("London bicycle hire",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Z6dVVFFrdooHIs8xnJ_O7eM5bhS5KscCi7G_k0jUNDI"))((function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("NYC citibike",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Aum0anWxPx6bHyfcFXWCCTE8u0xtfenIls_kPAJEDIA"))((function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("Chicago taxis",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1fhX98NFv5gAkkjB2YFCm50-fplFpmWVAZby3dmm9cgQ"))((function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("NL commuters",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Oe3zM219uSfJ3sjdRT90SAK2kU3xIvzdcCW6cwTsAuc"))((function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})})))}).call(this,__webpack_require__(132)(module))},427:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var dist_esm=__webpack_require__(34),react=__webpack_require__(8),react_default=__webpack_require__.n(react),legend_Disc=function(_a){var size=_a.size,inner=_a.inner,outer=_a.outer,outline=_a.outline;return react.createElement("svg",{width:size,height:size,style:{marginRight:5}},react.createElement("circle",{cx:size/2,cy:size/2,r:.5*size,fill:Object(dist_esm.rgbaAsString)(outline)}),react.createElement("circle",{cx:size/2,cy:size/2,r:.5*size-1,fill:Object(dist_esm.rgbaAsString)(outer)}),react.createElement("circle",{cx:size/2,cy:size/2,r:.5*size*.6-1,fill:Object(dist_esm.rgbaAsString)(inner)}))},styles={outer:{display:"flex",flexDirection:"column"},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}},legend_LocationTotalsLegend=function(_a){var diff=_a.diff,colors=_a.colors,aboutEqualText=_a.aboutEqualText,moreOutgoingText=_a.moreOutgoingText,moreIncomingText=_a.moreIncomingText,colorsRGBA=diff?Object(dist_esm.getDiffColorsRGBA)(colors):Object(dist_esm.getColorsRGBA)(colors),pos=Object(dist_esm.isDiffColorsRGBA)(colorsRGBA)?colorsRGBA.positive.locationCircles:colorsRGBA.locationCircles,neg=Object(dist_esm.isDiffColorsRGBA)(colorsRGBA)?colorsRGBA.negative.locationCircles:void 0;return react.createElement("div",{style:styles.outer},react.createElement("div",null,react.createElement("div",{style:styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.inner,outline:pos.inner}),neg&&react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.inner,outline:neg.inner}),react.createElement("div",{style:styles.item.caption},aboutEqualText||"outgoing ≅ incoming")),react.createElement("div",{style:styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.outgoing,outline:pos.inner}),neg&&react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.outgoing,outline:neg.inner}),react.createElement("div",{style:styles.item.caption},moreOutgoingText||"more outgoing")),react.createElement("div",{style:styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.incoming,outline:pos.incoming}),neg&&react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.incoming,outline:neg.incoming}),react.createElement("div",{style:styles.item.caption},moreIncomingText||"more incoming"))))},DiffColorsLegend_styles={outer:{display:"flex",flexDirection:"column"},disc:{marginRight:5},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}},legend_DiffColorsLegend=function(props){var colorsRGBA=Object(dist_esm.getDiffColorsRGBA)(props.colors),pos=colorsRGBA.positive.locationCircles,neg=colorsRGBA.negative.locationCircles;return react.createElement("div",{style:DiffColorsLegend_styles.outer},react.createElement("div",{style:DiffColorsLegend_styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.inner,outline:pos.inner}),react.createElement("div",{style:DiffColorsLegend_styles.item.caption},props.positiveText||"positive difference")),react.createElement("div",{style:DiffColorsLegend_styles.item.outer},react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.inner,outline:neg.inner}),react.createElement("div",{style:DiffColorsLegend_styles.item.caption},props.negativeText||"negative difference")))},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},LegendBox_styles_outer={position:"absolute",background:"#fff",padding:10,borderRadius:4,border:"1px solid #ccc"},legend_LegendBox=function(_a){var style=_a.style,top=_a.top,left=_a.left,right=_a.right,bottom=_a.bottom,children=_a.children;return react_default.a.createElement("div",{style:__assign(__assign(__assign({},LegendBox_styles_outer),style),{top:top,left:left,right:right,bottom:bottom})},children)},geo_viewport=__webpack_require__(434),src=__webpack_require__(436);function getViewStateForFeatures(featureCollection,size,opts){var _a=opts||{},_b=_a.pad,pad=void 0===_b?.05:_b,_c=_a.tileSize,tileSize=void 0===_c?512:_c,_d=_a.minZoom,minZoom=void 0===_d?0:_d,_e=_a.maxZoom,maxZoom=void 0===_e?100:_e,_f=Object(src.a)(featureCollection),_g=_f[0],x1=_g[0],y1=_g[1],_h=_f[1],x2=_h[0],y2=_h[1],bounds=[x1-pad*(x2-x1),y1-pad*(y2-y1),x2+pad*(x2-x1),y2+pad*(y2-y1)],_j=Object(geo_viewport.viewport)(bounds,size,void 0,void 0,tileSize,!0),_k=_j.center,longitude=_k[0],latitude=_k[1],zoom=_j.zoom;return{longitude:longitude,latitude:latitude,zoom:Math.max(Math.min(maxZoom,zoom),minZoom),bearing:0,pitch:0}}function getViewStateForLocations(locations,getLocationCentroid,size,opts){return getViewStateForFeatures({type:"GeometryCollection",geometries:locations.map((function(location){return{type:"Point",coordinates:getLocationCentroid(location)}}))},size,opts)}var extendStatics,deckgl=__webpack_require__(239),esm=__webpack_require__(308),__extends=(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),FlowMap_assign=function(){return(FlowMap_assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t},__spreadArrays=function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r},ESC_KEY="Escape",dist_esm_FlowMap=function(_super){function FlowMap(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.state={viewState:_this.props.initialViewState,time:0},_this.animationFrame=-1,_this.animate=function(){var timestamp=Date.now()/1e3;_this.setState({time:timestamp%60/60*1800}),_this.animationFrame=window.requestAnimationFrame(_this.animate)},_this.handleFlowMapHover=function(info){var type=info.type,object=info.object;switch(type){case dist_esm.PickingType.FLOW:object?_this.highlight({type:"flow",flow:object},info):_this.highlight(void 0);break;case dist_esm.PickingType.LOCATION_AREA:case dist_esm.PickingType.LOCATION:var getLocationId=_this.props.getLocationId;object?_this.highlight({type:type===dist_esm.PickingType.LOCATION_AREA?"locationArea":"location",locationId:(getLocationId||dist_esm.default.defaultProps.getLocationId.value)(object)},info):_this.highlight(void 0)}},_this.handleFlowMapClick=function(_a){var type=_a.type,object=_a.object;switch(type){case dist_esm.PickingType.LOCATION_AREA:case dist_esm.PickingType.LOCATION:if(object){var _b=_this.props,getLocationId=_b.getLocationId,multiselect=_b.multiselect,selectedLocationIds=_this.state.selectedLocationIds,locationId_1=(getLocationId||dist_esm.default.defaultProps.getLocationId.value)(object),isSelected=selectedLocationIds&&selectedLocationIds.indexOf(locationId_1)>=0,next=void 0;next=multiselect?selectedLocationIds?isSelected?selectedLocationIds.filter((function(id){return id!==locationId_1})):__spreadArrays(selectedLocationIds,[locationId_1]):[locationId_1]:isSelected?void 0:[locationId_1],_this.selectLocations(next),_this.highlight(void 0)}}},_this.handleViewStateChange=function(_a){var viewState=_a.viewState;_this.setState({viewState:viewState,highlight:void 0});var onViewStateChange=_this.props.onViewStateChange;onViewStateChange&&onViewStateChange(viewState)},_this.handleKeyDown=function(evt){evt instanceof KeyboardEvent&&evt.key===ESC_KEY&&_this.setState({selectedLocationIds:void 0,highlight:void 0})},_this}return __extends(FlowMap,_super),FlowMap.getDerivedStateFromProps=function(props,state){return props.selectedLocationIds&&props.selectedLocationIds!==state.selectedLocationIds?{selectedLocationIds:props.selectedLocationIds}:null},FlowMap.prototype.componentDidMount=function(){document.addEventListener("keydown",this.handleKeyDown),this.props.animate&&this.animate();var onViewStateChange=this.props.onViewStateChange;if(onViewStateChange){var viewState=this.state.viewState;viewState&&onViewStateChange(viewState)}},FlowMap.prototype.componentDidUpdate=function(prevProps,prevState,snapshot){var animate=this.props.animate;animate!==prevProps.animate&&(animate?this.animate():this.stopAnimation())},FlowMap.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.handleKeyDown),this.stopAnimation()},FlowMap.prototype.render=function(){var _a=this.props,mapboxAccessToken=_a.mapboxAccessToken,mapStyle=_a.mapStyle,mixBlendMode=_a.mixBlendMode,flowMapLayer=this.getFlowMapLayer();return react.createElement(react.Fragment,null,react.createElement(deckgl.a,{style:{mixBlendMode:mixBlendMode},layers:[flowMapLayer],viewState:this.state.viewState,controller:!0,onViewStateChange:this.handleViewStateChange,children:function(_a){var width=_a.width,height=_a.height,viewState=_a.viewState;return react.createElement(esm.StaticMap,{width:width,height:height,mapboxApiAccessToken:mapboxAccessToken,mapStyle:mapStyle,viewState:viewState})}}))},FlowMap.prototype.stopAnimation=function(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)},FlowMap.prototype.getFlowMapLayer=function(){var _a=this.props,flowMapLayerProps=(_a.initialViewState,_a.mapboxAccessToken,_a.mixBlendMode,_a.multiselect,_a.onSelected,_a.onHighlighted,__rest(_a,["initialViewState","mapboxAccessToken","mixBlendMode","multiselect","onSelected","onHighlighted"])),_b=this.state,highlight=_b.highlight,selectedLocationIds=_b.selectedLocationIds;return new dist_esm.default(FlowMap_assign(FlowMap_assign({id:"flow-map-layer",animationCurrentTime:this.state.time},flowMapLayerProps),{selectedLocationIds:selectedLocationIds,highlightedLocationId:highlight&&"location"===highlight.type?highlight.locationId:void 0,highlightedLocationAreaId:highlight&&"locationArea"===highlight.type?highlight.locationId:void 0,highlightedFlow:highlight&&"flow"===highlight.type?highlight.flow:void 0,onHover:this.handleFlowMapHover,onClick:this.handleFlowMapClick}))},FlowMap.prototype.highlight=function(highlight,info){this.setState({highlight:highlight});var onHighlighted=this.props.onHighlighted;onHighlighted&&onHighlighted(highlight,info)},FlowMap.prototype.selectLocations=function(selectedLocationIds){this.setState((function(state){return FlowMap_assign(FlowMap_assign({},state),{selectedLocationIds:selectedLocationIds})}));var onSelected=this.props.onSelected;onSelected&&onSelected(selectedLocationIds)},FlowMap.defaultProps={mixBlendMode:"multiply"},FlowMap}(react.Component);__webpack_require__.d(__webpack_exports__,"LocationTotalsLegend",(function(){return legend_LocationTotalsLegend})),__webpack_require__.d(__webpack_exports__,"DiffColorsLegend",(function(){return legend_DiffColorsLegend})),__webpack_require__.d(__webpack_exports__,"LegendBox",(function(){return legend_LegendBox})),__webpack_require__.d(__webpack_exports__,"getViewStateForFeatures",(function(){return getViewStateForFeatures})),__webpack_require__.d(__webpack_exports__,"getViewStateForLocations",(function(){return getViewStateForLocations}));__webpack_exports__.default=dist_esm_FlowMap},459:function(module,exports,__webpack_require__){__webpack_require__(460),__webpack_require__(573),module.exports=__webpack_require__(574)},481:function(module,exports){},574:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){__webpack_require__(575);var _storybook_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(188);const req=__webpack_require__(761);Object(_storybook_react__WEBPACK_IMPORTED_MODULE_1__.configure)((function loadStories(){req.keys().forEach(req)}),module)}.call(this,__webpack_require__(358)(module))},575:function(module,exports,__webpack_require__){var content=__webpack_require__(576);"string"==typeof content&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};__webpack_require__(578)(content,options);content.locals&&(module.exports=content.locals)},576:function(module,exports,__webpack_require__){(module.exports=__webpack_require__(577)(!1)).push([module.i,'/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nbody {\n  font-family: sans-serif;\n}\n',""])},761:function(module,exports,__webpack_require__){var map={"./basic.tsx":417,"./clustering.tsx":422,"./datasets.tsx":425};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=761},762:function(module,exports){},767:function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(420),core_1=__importDefault(__webpack_require__(34)),React=__importStar(__webpack_require__(8)),react_map_gl_1=__webpack_require__(308);exports.default=function(_a){var locations=_a.locations,flows=_a.flows,initialViewState=_a.initialViewState,mapboxAccessToken=_a.mapboxAccessToken,outlineThickness=_a.outlineThickness,flowMapLayer=new core_1.default({id:"flow-map-layer",locations:locations,flows:flows,getLocationId:function(loc){return loc.properties.abbr},showLocationAreas:!0,getFlowMagnitude:function(f){return f.count},showTotals:!0,outlineThickness:outlineThickness});return React.createElement(react_1.DeckGL,{style:{mixBlendMode:"multiply"},controller:!0,initialViewState:initialViewState,layers:[flowMapLayer],children:function(_a){var width=_a.width,height=_a.height,viewState=_a.viewState;return React.createElement(react_map_gl_1.StaticMap,{mapboxApiAccessToken:mapboxAccessToken,width:width,height:height,viewState:viewState})}})}},768:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var Cluster=__importStar(__webpack_require__(773)),core_1=__webpack_require__(34),react_1=__importDefault(__webpack_require__(8)),Example_1=__importDefault(__webpack_require__(423)),ClusteringExample=function(_super){function ClusteringExample(props){var _this=_super.call(this,props)||this;_this.handleViewStateChange=function(viewState){var availableZoomLevels=_this.clusterIndex.availableZoomLevels,zoom=viewState.zoom,clusterZoom=Cluster.findAppropriateZoomLevel(availableZoomLevels,zoom);_this.setState({clusteredLocations:_this.clusterIndex.getClusterNodesFor(clusterZoom),aggregateFlows:_this.aggregateFlowsByZoom.get(clusterZoom)})};var clusterLevels,_a=_this.props,flows=_a.flows,getLocationId=_a.getLocationId,getLocationCentroid=_a.getLocationCentroid,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,locations=core_1.isFeatureCollection(_this.props.locations)?_this.props.locations.features:_this.props.locations;if(_this.props.clusterLevels)clusterLevels=_this.props.clusterLevels;else{var getLocationWeight=Cluster.makeLocationWeightGetter(flows,{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude});clusterLevels=Cluster.clusterLocations(locations,{getLocationId:getLocationId,getLocationCentroid:getLocationCentroid},getLocationWeight,{makeClusterName:function(id,numPoints){return"Cluster #"+id+" of "+numPoints+" locations"}})}for(var clusterIndex=Cluster.buildIndex(clusterLevels),aggregateFlowsByZoom=new Map,_i=0,_b=clusterIndex.availableZoomLevels;_i<_b.length;_i++){var zoom=_b[_i];aggregateFlowsByZoom.set(zoom,clusterIndex.aggregateFlows(flows,zoom,{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude}))}var maxZoom=Math.max.apply(null,clusterIndex.availableZoomLevels);return _this.clusterIndex=clusterIndex,_this.aggregateFlowsByZoom=aggregateFlowsByZoom,_this.state={clusteredLocations:_this.clusterIndex.getClusterNodesFor(maxZoom),aggregateFlows:_this.aggregateFlowsByZoom.get(maxZoom)},_this}return __extends(ClusteringExample,_super),ClusteringExample.prototype.render=function(){var _a=this.props,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,_b=this.state,clusteredLocations=_b.clusteredLocations,aggregateFlows=_b.aggregateFlows;return clusteredLocations&&aggregateFlows?react_1.default.createElement(Example_1.default,{locations:clusteredLocations,flows:aggregateFlows,getLocationId:function(loc){return loc.id},getLocationCentroid:function(loc){return loc.centroid},getFlowOriginId:function(flow){return Cluster.isAggregateFlow(flow)?flow.origin:getFlowOriginId(flow)},getFlowDestId:function(flow){return Cluster.isAggregateFlow(flow)?flow.dest:getFlowDestId(flow)},getFlowMagnitude:function(flow){return Cluster.isAggregateFlow(flow)?flow.count:getFlowMagnitude(flow)},onViewStateChange:this.handleViewStateChange}):null},ClusteringExample}(react_1.default.Component);exports.default=ClusteringExample},773:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var extent=__webpack_require__(789),ascending=__webpack_require__(252),bisect=__webpack_require__(796);function isCluster(c){var children=c.children;return children&&children.length>0}function isAggregateFlow(flow){var _a=flow,origin=_a.origin,dest=_a.dest,count=_a.count,aggregate=_a.aggregate;return void 0!==origin&&void 0!==dest&&void 0!==count&&!!aggregate}var __values=function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar};function buildIndex(clusterLevels){var e_1,_a,e_2,_b,e_3,_c,nodesByZoom=new Map,clustersById=new Map,minZoomByLocationId=new Map;try{for(var clusterLevels_1=__values(clusterLevels),clusterLevels_1_1=clusterLevels_1.next();!clusterLevels_1_1.done;clusterLevels_1_1=clusterLevels_1.next()){var _d=clusterLevels_1_1.value,zoom=_d.zoom,nodes=_d.nodes;nodesByZoom.set(zoom,nodes);try{for(var nodes_1=(e_2=void 0,__values(nodes)),nodes_1_1=nodes_1.next();!nodes_1_1.done;nodes_1_1=nodes_1.next()){var node=nodes_1_1.value;if(isCluster(node))clustersById.set(node.id,node);else{var id=node.id,mz=minZoomByLocationId.get(id);(null==mz||mz>zoom)&&minZoomByLocationId.set(id,zoom)}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{nodes_1_1&&!nodes_1_1.done&&(_b=nodes_1.return)&&_b.call(nodes_1)}finally{if(e_2)throw e_2.error}}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{clusterLevels_1_1&&!clusterLevels_1_1.done&&(_a=clusterLevels_1.return)&&_a.call(clusterLevels_1)}finally{if(e_1)throw e_1.error}}var _e=__read(Object(extent.a)(clusterLevels,(function(cl){return cl.zoom})),2),minZoom=_e[0],maxZoom=_e[1];if(null==minZoom||null==maxZoom)throw new Error("Could not determine minZoom or maxZoom");var leavesToClustersByZoom=new Map,_loop_1=function(cluster){var zoom=cluster.zoom,leavesToClusters=leavesToClustersByZoom.get(zoom);leavesToClusters||(leavesToClusters=new Map,leavesToClustersByZoom.set(zoom,leavesToClusters)),function visitClusterLeaves(cluster,visit){var e_4,_a;try{for(var _b=__values(cluster.children),_c=_b.next();!_c.done;_c=_b.next()){var childId=_c.value,child=clustersById.get(childId);child?visitClusterLeaves(child,visit):visit(childId)}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_4)throw e_4.error}}}(cluster,(function(leafId){leavesToClusters.set(leafId,cluster)}))};try{for(var _f=__values(clustersById.values()),_g=_f.next();!_g.done;_g=_f.next()){_loop_1(_g.value)}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_g&&!_g.done&&(_c=_f.return)&&_c.call(_f)}finally{if(e_3)throw e_3.error}}function findClusterFor(locationId,zoom){var leavesToClusters=leavesToClustersByZoom.get(zoom);if(leavesToClusters){var cluster=leavesToClusters.get(locationId);return cluster?cluster.id:void 0}}return{availableZoomLevels:clusterLevels.map((function(cl){return+cl.zoom})).sort((function(a,b){return Object(ascending.a)(a,b)})),getClusterNodesFor:function(zoom){if(void 0!==zoom)return nodesByZoom.get(zoom)},getClusterById:function(clusterId){return clustersById.get(clusterId)},getMinZoomForLocation:function(locationId){return minZoomByLocationId.get(locationId)||minZoom},expandCluster:function(cluster,targetZoom){void 0===targetZoom&&(targetZoom=maxZoom);var ids=[],visit=function(c,expandedIds){var e_5,_a;if(targetZoom>c.zoom)try{for(var _b=__values(c.children),_c=_b.next();!_c.done;_c=_b.next()){var childId=_c.value,child=clustersById.get(childId);child?visit(child,expandedIds):expandedIds.push(childId)}}catch(e_5_1){e_5={error:e_5_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_5)throw e_5.error}}else expandedIds.push(c.id)};return visit(cluster,ids),ids},findClusterFor:findClusterFor,aggregateFlows:function(flows,zoom,_a,options){var e_6,_b,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude;if(void 0===options&&(options={}),zoom>maxZoom)return flows;var result=[],aggFlowsByKey=new Map,makeKey=function(origin,dest){return origin+":"+dest},_c=options.flowCountsMapReduce,flowCountsMapReduce=void 0===_c?{map:getFlowMagnitude,reduce:function(acc,count){return(acc||0)+count}}:_c;try{for(var flows_1=__values(flows),flows_1_1=flows_1.next();!flows_1_1.done;flows_1_1=flows_1.next()){var flow=flows_1_1.value,origin_1=getFlowOriginId(flow),dest=getFlowDestId(flow),originCluster=findClusterFor(origin_1,zoom)||origin_1,destCluster=findClusterFor(dest,zoom)||dest,key=makeKey(originCluster,destCluster);if(originCluster===origin_1&&destCluster===dest)result.push(flow);else{var aggregateFlow=aggFlowsByKey.get(key);aggregateFlow?aggregateFlow.count=flowCountsMapReduce.reduce(aggregateFlow.count,flowCountsMapReduce.map(flow)):(aggregateFlow={origin:originCluster,dest:destCluster,count:flowCountsMapReduce.map(flow),aggregate:!0},result.push(aggregateFlow),aggFlowsByKey.set(key,aggregateFlow))}}}catch(e_6_1){e_6={error:e_6_1}}finally{try{flows_1_1&&!flows_1_1.done&&(_b=flows_1.return)&&_b.call(flows_1)}finally{if(e_6)throw e_6.error}}return result}}}function makeLocationWeightGetter(flows,_a){var e_7,_b,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,locationTotals={incoming:new Map,outgoing:new Map};try{for(var flows_2=__values(flows),flows_2_1=flows_2.next();!flows_2_1.done;flows_2_1=flows_2.next()){var flow=flows_2_1.value,origin_2=getFlowOriginId(flow),dest=getFlowDestId(flow),count=getFlowMagnitude(flow);locationTotals.incoming.set(dest,(locationTotals.incoming.get(dest)||0)+count),locationTotals.outgoing.set(origin_2,(locationTotals.outgoing.get(dest)||0)+count)}}catch(e_7_1){e_7={error:e_7_1}}finally{try{flows_2_1&&!flows_2_1.done&&(_b=flows_2.return)&&_b.call(flows_2)}finally{if(e_7)throw e_7.error}}return function(id){return Math.max(Math.abs(locationTotals.incoming.get(id)||0),Math.abs(locationTotals.outgoing.get(id)||0))}}function findAppropriateZoomLevel(availableZoomLevels,targetZoom){if(!availableZoomLevels.length)throw new Error("No available zoom levels");return availableZoomLevels[Math.min(Object(bisect.a)(availableZoomLevels,Math.floor(targetZoom)),availableZoomLevels.length-1)]}var group=__webpack_require__(795),src=__webpack_require__(314),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},cluster_read=function(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar},cluster_values=function(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},defaultOptions={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:function(id,numPoints){},makeClusterId:function(id){return"{["+id+"]}"}};function isClusterPoint(p){return null!=p.id}function clusterLocations(locations,locationAccessors,getLocationWeight,options){for(var e_1,_a,lng,getLocationCentroid=locationAccessors.getLocationCentroid,getLocationId=locationAccessors.getLocationId,opts=__assign(__assign({},defaultOptions),options),minZoom=opts.minZoom,maxZoom=opts.maxZoom,nodeSize=opts.nodeSize,makeClusterName=opts.makeClusterName,makeClusterId=opts.makeClusterId,trees=new Array(maxZoom+1),clusters=new Array,i=0;i<locations.length;i++){var _b=cluster_read(getLocationCentroid(locations[i]),2),x=_b[0],y=_b[1];clusters.push({x:(lng=x,lng/360+.5),y:latY(y),weight:getLocationWeight(getLocationId(locations[i])),zoom:1/0,index:i,parentId:-1})}trees[maxZoom+1]=new src.a(clusters,getX,getY,nodeSize,Float32Array);for(var z=maxZoom;z>=minZoom;z--)clusters=cluster_cluster(clusters,z,trees[z+1],opts),trees[z]=new src.a(clusters,getX,getY,nodeSize,Float32Array);if(0===trees.length)return[];for(var numbersOfClusters=trees.map((function(d){return d.points.length})),maxAvailZoom=numbersOfClusters.indexOf(numbersOfClusters[numbersOfClusters.length-1]),minAvailZoom=Math.min(maxAvailZoom,numbersOfClusters.lastIndexOf(numbersOfClusters[0])),clusterLevels=new Array,zoom=minAvailZoom;zoom<=maxAvailZoom;zoom++){var childrenByParent=void 0,tree=trees[zoom];zoom<maxAvailZoom&&(childrenByParent=Object(group.a)(trees[zoom+1].points,(function(points){return points.map((function(p){return p.id?makeClusterId(p.id):getLocationId(locations[p.index])}))}),(function(point){return point.parentId})));var nodes=[];try{for(var _c=(e_1=void 0,cluster_values(tree.points)),_d=_c.next();!_d.done;_d=_c.next()){var point=_d.value,numPoints=(x=point.x,y=point.y,point.numPoints);if(null!=point.index){var location_1=locations[point.index];nodes.push({id:getLocationId(location_1),zoom:zoom,centroid:getLocationCentroid(location_1)})}else if(isClusterPoint(point)){var id=point.id,children=childrenByParent&&childrenByParent.get(id);if(!children)throw new Error("Cluster "+id+" doesn't have children");var cluster_1={id:makeClusterId(id),name:makeClusterName(id,numPoints),zoom:zoom,centroid:[xLng(x),yLat(y)],children:children};nodes.push(cluster_1)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_1)throw e_1.error}}clusterLevels.push({zoom:zoom,nodes:nodes})}return clusterLevels}function createCluster(x,y,id,numPoints,weight){return{x:x,y:y,zoom:1/0,id:id,parentId:-1,numPoints:numPoints,weight:weight}}function cluster_cluster(points,zoom,tree,options){for(var e_2,_a,clusters=[],r=options.radius/(options.extent*Math.pow(2,zoom)),i=0;i<points.length;i++){var p=points[i];if(!(p.zoom<=zoom)){p.zoom=zoom;var neighborIds=tree.within(p.x,p.y,r),weight=p.weight||1,numPoints=isClusterPoint(p)?p.numPoints:1,wx=p.x*weight,wy=p.y*weight,id=(i<<5)+(zoom+1);try{for(var neighborIds_1=(e_2=void 0,cluster_values(neighborIds)),neighborIds_1_1=neighborIds_1.next();!neighborIds_1_1.done;neighborIds_1_1=neighborIds_1.next()){var neighborId=neighborIds_1_1.value,b=tree.points[neighborId];if(!(b.zoom<=zoom)){b.zoom=zoom;var weight2=b.weight||1,numPoints2=b.numPoints||1;wx+=b.x*weight2,wy+=b.y*weight2,weight+=weight2,numPoints+=numPoints2,b.parentId=id}}}catch(e_2_1){e_2={error:e_2_1}}finally{try{neighborIds_1_1&&!neighborIds_1_1.done&&(_a=neighborIds_1.return)&&_a.call(neighborIds_1)}finally{if(e_2)throw e_2.error}}1===numPoints?clusters.push(p):(p.parentId=id,clusters.push(createCluster(wx/weight,wy/weight,id,numPoints,weight)))}}return clusters}function xLng(x){return 360*(x-.5)}function yLat(y){var y2=(180-360*y)*Math.PI/180;return 360*Math.atan(Math.exp(y2))/Math.PI-90}function latY(lat){var sin=Math.sin(lat*Math.PI/180),y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;return y<0?0:y>1?1:y}function getX(p){return p.x}function getY(p){return p.y}__webpack_require__.d(__webpack_exports__,"buildIndex",(function(){return buildIndex})),__webpack_require__.d(__webpack_exports__,"makeLocationWeightGetter",(function(){return makeLocationWeightGetter})),__webpack_require__.d(__webpack_exports__,"findAppropriateZoomLevel",(function(){return findAppropriateZoomLevel})),__webpack_require__.d(__webpack_exports__,"isCluster",(function(){return isCluster})),__webpack_require__.d(__webpack_exports__,"isAggregateFlow",(function(){return isAggregateFlow})),__webpack_require__.d(__webpack_exports__,"clusterLocations",(function(){return clusterLocations}))}},[[459,1,2]]]);
//# sourceMappingURL=main.f853d0f71414f2ab944a.bundle.js.map